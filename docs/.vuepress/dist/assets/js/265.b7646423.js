(window.webpackJsonp=window.webpackJsonp||[]).push([[265],{2138:function(s,e,a){"use strict";a.r(e);var t=a(18),r=Object(t.a)({},(function(){var s=this,e=s._self._c;return e("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[e("h1",{attrs:{id:"redis的setnx命令作用"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#redis的setnx命令作用"}},[s._v("#")]),s._v(" redis的SETNX命令作用")]),s._v(" "),e("p",[s._v('SETNX 是 Redis 的一个原子命令，全称是 "SET if Not eXists"（不存在时设置）。其作用为：')]),s._v(" "),e("ul",[e("li",[s._v("当指定键 "),e("strong",[s._v("不存在")]),s._v(" 时，将键设置为指定的值，并返回 "),e("code",[s._v("1")]),s._v("（设置成功）。")]),s._v(" "),e("li",[s._v("当指定键 "),e("strong",[s._v("已存在")]),s._v(" 时，不进行任何操作，并返回 "),e("code",[s._v("0")]),s._v("（设置失败）。")])]),s._v(" "),e("h2",{attrs:{id:"典型用途"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#典型用途"}},[s._v("#")]),s._v(" 典型用途")]),s._v(" "),e("ul",[e("li",[e("strong",[s._v("分布式锁")]),s._v("：多个客户端尝试 SETNX 同一个锁键，只有一个能成功获得锁。")]),s._v(" "),e("li",[e("strong",[s._v("去重标记")]),s._v("：例如防止重复处理消息，用 SETNX 标记已处理的消息 ID。")])]),s._v(" "),e("h2",{attrs:{id:"命令格式"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#命令格式"}},[s._v("#")]),s._v(" 命令格式")]),s._v(" "),e("div",{staticClass:"language-shell line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[s._v("SETNX key value\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("h2",{attrs:{id:"示例"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#示例"}},[s._v("#")]),s._v(" 示例")]),s._v(" "),e("p",[s._v("假如：用业务标志是user，用户id为：1.则：user:1就是redis的key。")]),s._v(" "),e("p",[s._v("第一步：用户的第一个请求。")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v('SETNX user:1 "Hello"\n')])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("p",[s._v("返回1，表示设置成功。")]),s._v(" "),e("p",[e("img",{attrs:{src:a(648),alt:"image-20260216143703136"}})]),s._v(" "),e("p",[s._v("第二步：用户的重复提交请求。")]),s._v(" "),e("div",{staticClass:"language-shell line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[s._v("SETNX user:1 "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"World"')]),s._v("\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("p",[s._v("user:1已经存在了，用户提交的重复请求返回0表示redis的user:1标识的key已经存在了。")]),s._v(" "),e("div",{staticClass:"language-shell line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[s._v("线上tx:"),e("span",{pre:!0,attrs:{class:"token operator"}},[e("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[s._v("0")]),s._v(">")]),s._v("SETNX user:1 "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"World"')]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"0"')]),s._v("\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br")])]),e("p",[s._v("问题1：这个user:1的key被设置后是永久存在的吗？")]),s._v(" "),e("h2",{attrs:{id:"注意事项"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#注意事项"}},[s._v("#")]),s._v(" 注意事项")]),s._v(" "),e("ul",[e("li",[s._v("SETNX 是原子操作，在 Redis 单线程模型下天然保证并发安全。")]),s._v(" "),e("li",[s._v("在 Redis 2.6.12 之后，也可以使用带 "),e("code",[s._v("NX")]),s._v(" 参数的 "),e("code",[s._v("SET")]),s._v(" 命令实现相同功能："),e("code",[s._v("SET key value NX")]),s._v("。")])])])}),[],!1,null,null,null);e.default=r.exports},648:function(s,e,a){s.exports=a.p+"assets/img/image-20260216143703136.9c792c74.png"}}]);