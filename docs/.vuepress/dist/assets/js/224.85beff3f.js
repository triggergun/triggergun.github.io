(window.webpackJsonp=window.webpackJsonp||[]).push([[224],{1895:function(s,e,a){s.exports=a.p+"assets/img/image-20240101161735613.5d9d1960.png"},1896:function(s,e,a){s.exports=a.p+"assets/img/image-20240101162437680.372623bf.png"},2314:function(s,e,a){"use strict";a.r(e);var t=a(18),n=Object(t.a)({},(function(){var s=this,e=s._self._c;return e("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[e("h1",{attrs:{id:"_05-idea连接远程docker构建镜像"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_05-idea连接远程docker构建镜像"}},[s._v("#")]),s._v(" 05)idea连接远程docker构建镜像")]),s._v(" "),e("h2",{attrs:{id:"启动远程镜像服务"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#启动远程镜像服务"}},[s._v("#")]),s._v(" 启动远程镜像服务")]),s._v(" "),e("div",{staticClass:"language-shell line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[e("span",{pre:!0,attrs:{class:"token function"}},[s._v("vim")]),s._v(" /usr/lib/systemd/system/docker.service\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("div",{staticClass:"language-shell line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[s._v("在ExecStart"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/usr/bin/dockerd 后面加上-H tcp://0.0.0.0:2375 "),e("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-H")]),s._v(" unix://var/run/docker.sock\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v(" -H fd:// --containerd=/run/containerd/containerd.sock\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("h2",{attrs:{id:"重新加载配置文件"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#重新加载配置文件"}},[s._v("#")]),s._v(" 重新加载配置文件")]),s._v(" "),e("div",{staticClass:"language-shell line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[e("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" systemctl daemon-reload \n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("h2",{attrs:{id:"重新启动docker"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#重新启动docker"}},[s._v("#")]),s._v(" 重新启动docker")]),s._v(" "),e("div",{staticClass:"language-shell line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[e("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" systemctl restart "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v("\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("h2",{attrs:{id:"启动远程镜像无法启动docker问题"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#启动远程镜像无法启动docker问题"}},[s._v("#")]),s._v(" 启动远程镜像无法启动docker问题")]),s._v(" "),e("div",{staticClass:"custom-block warning"},[e("p",{staticClass:"custom-block-title"},[s._v("一定要按照如下配置进行")]),s._v(" "),e("ul",[e("li",[s._v("这个问题我花费了2个多小时解决。按照如下步骤可以开启远程访问。")]),s._v(" "),e("li",[s._v("我google查过，找了很久找到解决方案。")])])]),s._v(" "),e("p",[s._v("场景：我按照上面的步骤配置后。启动docker报错。开启远程docker访问失败。")]),s._v(" "),e("ul",[e("li",[s._v("报错一")])]),s._v(" "),e("p",[e("img",{attrs:{src:a(1895),alt:"image-20240101161735613"}})]),s._v(" "),e("div",{staticClass:"language-shell line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@VM-8-4-centos movie_service_compose"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# sudo systemctl restart docker")]),s._v("\nJob "),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" docker.service failed because start of the "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("service")]),s._v(" was attempted too often. See "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"systemctl status docker.service"')]),s._v(" and "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"journalctl -xe"')]),s._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" details.\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br")])]),e("ul",[e("li",[s._v("报错二，查看镜像都报错。")])]),s._v(" "),e("div",{staticClass:"language-shell line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@VM-8-4-centos movie_service_compose"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# docker images")]),s._v("\nCannot connect to the Docker daemon at unix:///var/run/docker.sock. Is the "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" daemon running?\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br")])]),e("ul",[e("li",[s._v("报错三，启动停止也是报错。")])]),s._v(" "),e("h3",{attrs:{id:"解决"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#解决"}},[s._v("#")]),s._v(" 解决")]),s._v(" "),e("p",[s._v("我的"),e("a",{attrs:{href:"https://so.csdn.net/so/search?q=docker&spm=1001.2101.3001.7020",target:"_blank",rel:"noopener noreferrer"}},[s._v("docker"),e("OutboundLink")],1),s._v("版本：")]),s._v(" "),e("div",{staticClass:"language-shell line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@VM-8-4-centos movie_service_compose"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# docker -v")]),s._v("\nDocker version "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("24.0")]),s._v(".7, build afdd53b\n"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@VM-8-4-centos movie_service_compose"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ")]),s._v("\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br")])]),e("p",[s._v("参考网上的一个说明，docker开启远程访问的配置为：")]),s._v(" "),e("ul",[e("li",[s._v("第一步：创建 "),e("code",[s._v("/etc/docker/daemon.json")]),s._v(" 文件（如果已经存在则修改），加入以下内容：")])]),s._v(" "),e("div",{staticClass:"language-shell line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[e("span",{pre:!0,attrs:{class:"token function"}},[s._v("vi")]),s._v(" /etc/docker/daemon.json\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("div",{staticClass:"language-json line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-json"}},[e("code",[e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  "),e("span",{pre:!0,attrs:{class:"token property"}},[s._v('"hosts"')]),s._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"unix:///var/run/docker.sock"')]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"tcp://0.0.0.0:2375"')]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br")])]),e("ul",[e("li",[e("code",[s._v('"unix:///var/run/docker.sock"')]),s._v("：unix socket，本地客户端将通过这个来连接 Docker Daemon。")]),s._v(" "),e("li",[e("code",[s._v('"tcp://0.0.0.0:2375"')]),s._v("：tcp socket，表示允许任何远程客户端通过 2375 端口连接 Docker Daemon。")])]),s._v(" "),e("p",[e("strong",[s._v("第二步")]),s._v("：下面重启docker。")]),s._v(" "),e("p",[s._v("查看dockerd报错日志：")]),s._v(" "),e("div",{staticClass:"language-shell line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[s._v("journalctl "),e("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-u")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v("\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("p",[s._v("有这么一行报错日志。")]),s._v(" "),e("div",{staticClass:"language-shell line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[s._v(" dockerd"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("12747")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(": unable to configure the Docker daemon with "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("file")]),s._v(" /etc/docker/daemon.json: \nthe following directives are specified both as  a flag and "),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("in")]),s._v(" the configuration file: hosts: "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("from flag: "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("fd://"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(", from file: "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("unix:///var/run/docker.sock tcp://0.0.0.0:2375"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br")])]),e("p",[s._v("经过查阅相关资料，官网文档上有说这个错误原因：")]),s._v(" "),e("p",[s._v("https://docs.docker.com/config/daemon/#use-the-hosts-key-in-daemonjson-with-systemd")]),s._v(" "),e("p",[s._v("简而言之，就是配置冲突。")]),s._v(" "),e("p",[s._v("解决方法：")]),s._v(" "),e("p",[s._v("修改docker.service文件")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v(" vim /usr/lib/systemd/system/docker.service\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("p",[s._v("删掉【service】单元中ExecStart中的-H参数，如图")]),s._v(" "),e("p",[e("img",{attrs:{src:a(1896),alt:"image-20240101162437680"}})]),s._v(" "),e("p",[s._v("然后重启docker，问题解决。")])])}),[],!1,null,null,null);e.default=n.exports}}]);