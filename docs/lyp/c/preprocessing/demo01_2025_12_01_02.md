# `#ifdef`基本语法

`#ifdef`后面能写什么？

ai回答：`#ifdef` 后面只能写 **一个宏名称（标识符）**，不能写表达式或其他内容。

## 1. **基本语法**

```c
#ifdef 宏名称
    // 代码块
#endif
```

## 2. **能写什么？**

✅ **正确的写法**

```c
// 1. 简单的宏名
#ifdef DEBUG
    printf("调试模式\n");
#endif

// 2. 编译器预定义的宏
#ifdef __linux__
    // Linux专用代码
#endif

// 3. 自己定义的宏
#define FEATURE_X
#ifdef FEATURE_X
    // 启用功能X
#endif

// 4. 带下划线或数字的宏名
#ifdef _VERSION_2_0
#ifdef MAX_SIZE_128
```

❌ **错误的写法**

```c
// 错误1：不能有运算符
#ifdef DEBUG == 1      // ❌ 错误！
#ifdef (DEBUG)         // ❌ 错误！

// 错误2：不能有逻辑运算
#ifdef DEBUG && TEST   // ❌ 错误！
#ifdef !RELEASE        // ❌ 错误！

// 错误3：不能是表达式
#ifdef sizeof(int)     // ❌ 错误！
#ifdef 3.14           // ❌ 错误！
```



## 3. **如果需要复杂条件怎么办？**

使用 `#if` 而不是 `#ifdef`：

```c
// ✅ 正确：使用 #if 处理复杂条件
#if defined(DEBUG) && (VERSION > 2)
    // DEBUG已定义 且 VERSION大于2
#endif

// ✅ 正确：使用 #if defined()
#if defined(WIN32) || defined(WIN64)
    // Windows平台
#endif

// ✅ 正确：检查宏的值
#if VERSION == 2024
    // 版本为2024
#endif
```

## 4. **`#ifdef` 的等价写法**

```c
// 这两行完全等价
#ifdef MACRO
#if defined(MACRO)

// 这两行完全等价
#ifndef MACRO  
#if !defined(MACRO)
```



## 5. **实际使用案例对比**

案例1：只检查是否定义（用 `#ifdef`）

```c
// 简单判断：是否定义了宏
#ifdef ENABLE_LOG
    log_message("程序启动");
#endif
```



案例2：检查定义且值满足条件（用 `#if`）

```c
// 复杂判断：宏的值要大于10
#if defined(MAX_USERS) && (MAX_USERS > 10)
    printf("支持多用户\n");
#endif
```

案例3：多个条件组合

```c
// 错误：不能用 #ifdef
#ifdef LINUX && DEBUG  // ❌ 语法错误！

// 正确：用 #if defined()
#if defined(LINUX) && defined(DEBUG)
    // Linux且调试模式
#endif
```

## 6. **常见问题**

**问：`#ifdef 1` 可以吗？**

```
#ifdef 1  // ❌ 错误！1不是有效的标识符
```

**正确做法**：

```
#if 1      // ✅ 正确：永远为真
#define ENABLE_FEATURE 1
#ifdef ENABLE_FEATURE  // ✅ 正确
```

**问：`#ifdef "LINUX"` 可以吗？**

```
#ifdef "LINUX"  // ❌ 错误！字符串不是标识符
```

**正确做法**：

```
#ifdef __linux__  // ✅ 正确：编译器预定义的宏
```

## 7. **总结表**

| 指令      | 后面能写什么                  | 用途             |
| :-------- | :---------------------------- | :--------------- |
| `#ifdef`  | **单个宏名称**                | 检查宏是否已定义 |
| `#ifndef` | **单个宏名称**                | 检查宏是否未定义 |
| `#if`     | **表达式**（可包含defined()） | 复杂条件判断     |
| `#elif`   | **表达式**                    | else if 分支     |
| `#else`   | **什么都不写**                | else 分支        |

**简单规则**：

- 只需要检查**是否定义** → 用 `#ifdef`
- 需要检查**宏的值**或**组合条件** → 用 `#if defined(...)`

记住：`#ifdef` 是 `#if defined()` 的**简化版**，只能用于最简单的"是否定义"检查。

