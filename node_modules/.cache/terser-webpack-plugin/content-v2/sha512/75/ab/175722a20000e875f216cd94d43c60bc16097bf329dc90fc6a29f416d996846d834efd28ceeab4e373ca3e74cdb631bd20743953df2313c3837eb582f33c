{"code":"(window.webpackJsonp=window.webpackJsonp||[]).push([[193],{1969:function(_,v,e){\"use strict\";e.r(v);var o=e(18),t=Object(o.a)({},(function(){var _=this,v=_._self._c;return v(\"ContentSlotsDistributor\",{attrs:{\"slot-key\":_.$parent.slotKey}},[v(\"h1\",{attrs:{id:\"微信小程序登录流程架构是怎么样的\"}},[v(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#微信小程序登录流程架构是怎么样的\"}},[_._v(\"#\")]),_._v(\" 微信小程序登录流程架构是怎么样的？\")]),_._v(\" \"),v(\"p\",[_._v(\"为什么第一步先要在客户端获取code字符串？\")]),_._v(\" \"),v(\"p\",[_._v(\"为什么需要code给后端加上AppID（小程序唯一标识）\"),v(\"code\",[_._v(\"、\")]),_._v(\"AppSecret（小程序后台生成的。不能泄露！）去微信官方获取openId？\")]),_._v(\" \"),v(\"p\",[_._v(\"openId作用是什么？\")]),_._v(\" \"),v(\"p\",[_._v(\"为什么访问微信官方的api需要access_token？\")]),_._v(\" \"),v(\"p\",[_._v(\"我现在也一时回答不上来上面的问题。不过其中本质也都是有记可循的。都是遵循混合了多个OAuth 2.0授权模式的复合流程。熟读OAuth 2.0协议显得更为重要。\")]),_._v(\" \"),v(\"p\",[_._v(\"现在来捋一捋微信小程序的登入流程逻辑是怎么样的。为什么要捋一捋？答：一方面站在平台的角度思考：微信平台有这个流程。那么飞书、钉钉、企业微信、等都有这一套流程。\")]),_._v(\" \"),v(\"h2\",{attrs:{id:\"微信小程序的登录流程解析\"}},[v(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#微信小程序的登录流程解析\"}},[_._v(\"#\")]),_._v(\" 微信小程序的登录流程解析\")]),_._v(\" \"),v(\"p\",[v(\"img\",{attrs:{src:e(360),alt:\"image-20251223170812443\"}})]),_._v(\" \"),v(\"p\",[_._v(\"微信小程序的登录流程巧妙地结合了两种OAuth模式：\")]),_._v(\" \"),v(\"ol\",[v(\"li\",[v(\"strong\",[_._v(\"第一阶段：获取用户临时凭证（类似“简化模式”）\")]),_._v(\"\\n小程序前端调用 \"),v(\"code\",[_._v(\"wx.login()\")]),_._v(\"，从微信获取一个临时的登录凭证 \"),v(\"code\",[_._v(\"code\")]),_._v(\"。这个过程不涉及你的服务器，是前端直接与\"),v(\"strong\",[_._v(\"微信\")]),_._v(\"的交互。\")]),_._v(\" \"),v(\"li\",[v(\"strong\",[_._v(\"第二阶段：服务端凭证校验（类似“授权码模式”）\")]),_._v(\" \"),v(\"ul\",[v(\"li\",[_._v(\"你的\"),v(\"strong\",[_._v(\"后端服务器\")]),_._v(\"收到前端发来的 \"),v(\"code\",[_._v(\"code\")]),_._v(\"。\")]),_._v(\" \"),v(\"li\",[_._v(\"后端同时使用小程序的 \"),v(\"code\",[_._v(\"AppID\")]),_._v(\"、\"),v(\"code\",[_._v(\"AppSecret\")]),_._v(\" 和这个 \"),v(\"code\",[_._v(\"code\")]),_._v(\"，向微信服务器发起请求。\")]),_._v(\" \"),v(\"li\",[_._v(\"微信服务器验证通过后，返回该用户的唯一标识 \"),v(\"code\",[_._v(\"openid\")]),_._v(\" 和本次会话的密钥 \"),v(\"code\",[_._v(\"session_key\")]),_._v(\"。\")])])])]),_._v(\" \"),v(\"p\",[v(\"strong\",[_._v(\"关键点分析\")]),_._v(\"：\")]),_._v(\" \"),v(\"ul\",[v(\"li\",[_._v(\"你的后端服务器在这里使用了 \"),v(\"code\",[_._v(\"AppID\")]),_._v(\" 和 \"),v(\"code\",[_._v(\"AppSecret\")]),_._v(\"（这\"),v(\"strong\",[_._v(\"类似\")]),_._v(\"客户端凭证）来向微信证明“我是哪个合法的小程序”。\")]),_._v(\" \"),v(\"li\",[_._v(\"但目的不是为自己获取一个调用API的令牌，而是为了用 \"),v(\"code\",[_._v(\"code\")]),_._v(\" 去\"),v(\"strong\",[_._v(\"换取特定用户的身份信息\")]),_._v(\"。\")]),_._v(\" \"),v(\"li\",[_._v(\"因此，\"),v(\"code\",[_._v(\"AppID\")]),_._v(\" 和 \"),v(\"code\",[_._v(\"AppSecret\")]),_._v(\" 在此处的作用是验证应用合法性，而 \"),v(\"code\",[_._v(\"code\")]),_._v(\" 才是代表用户授权的关键。\")])]),_._v(\" \"),v(\"h2\",{attrs:{id:\"openid的生成原理是什么\"}},[v(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#openid的生成原理是什么\"}},[_._v(\"#\")]),_._v(\" \"),v(\"code\",[_._v(\"openid\")]),_._v(\"的生成原理是什么？\")]),_._v(\" \"),v(\"p\",[_._v(\"生成原理与特性\")]),_._v(\" \"),v(\"p\",[_._v(\"虽然没有公开算法，但其\"),v(\"strong\",[_._v(\"核心逻辑\")]),_._v(\"和\"),v(\"strong\",[_._v(\"特性\")]),_._v(\"是清晰的：\")]),_._v(\" \"),v(\"ol\",[v(\"li\",[v(\"strong\",[_._v(\"依赖参数\")]),_._v(\"：系统内部生成 \"),v(\"code\",[_._v(\"openid\")]),_._v(\" 至少依赖两个核心参数：\"),v(\"strong\",[_._v(\"用户微信账号的唯一标识\")]),_._v(\"（微信内部ID）和 \"),v(\"strong\",[_._v(\"当前应用的 \"),v(\"code\",[_._v(\"AppID\")])]),_._v(\"。\")]),_._v(\" \"),v(\"li\",[v(\"strong\",[_._v(\"确定性结果\")]),_._v(\"：只要用户的微信账号和应用的 \"),v(\"code\",[_._v(\"AppID\")]),_._v(\" 不变，生成的 \"),v(\"code\",[_._v(\"openid\")]),_._v(\" 就始终固定。这意味着它不是随机生成的。\")])]),_._v(\" \"),v(\"p\",[v(\"img\",{attrs:{src:e(361),alt:\"image-20251223171508950\"}})]),_._v(\" \"),v(\"ol\",{attrs:{start:\"3\"}},[v(\"li\",[v(\"strong\",[_._v(\"不可逆与单向性\")]),_._v(\"：此生成过程是单向的、不可逆的。你无法从 \"),v(\"code\",[_._v(\"openid\")]),_._v(\" 反推出用户的\"),v(\"strong\",[_._v(\"微信账号\")]),_._v(\"或其他\"),v(\"strong\",[_._v(\"个人信息\")]),_._v(\"，这保障了用户身份的隐私安全。\")])]),_._v(\" \"),v(\"h2\",{attrs:{id:\"重要注意事项\"}},[v(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#重要注意事项\"}},[_._v(\"#\")]),_._v(\" 重要注意事项\")]),_._v(\" \"),v(\"ul\",[v(\"li\",[v(\"strong\",[_._v(\"不要传输或存储 \"),v(\"code\",[_._v(\"AppSecret\")])]),_._v(\"：小程序的 \"),v(\"code\",[_._v(\"AppSecret\")]),_._v(\" 是最高机密，必须存储在服务器端，绝不可放在小程序前端代码中，以防泄露。\")]),_._v(\" \"),v(\"li\",[v(\"strong\",[v(\"code\",[_._v(\"openid\")]),_._v(\" 不是用户登录态\")]),_._v(\"：获取 \"),v(\"code\",[_._v(\"openid\")]),_._v(\" 后，开发者服务器通常会据此生成一套自己的会话系统（例如自定义的 \"),v(\"code\",[_._v(\"token\")]),_._v(\"），用于维持用户在小程序内的登录状态，而不是直接使用 \"),v(\"code\",[_._v(\"openid\")]),_._v(\" 本身。\")]),_._v(\" \"),v(\"li\",[v(\"strong\",[_._v(\"关联多应用用 \"),v(\"code\",[_._v(\"unionid\")])]),_._v(\"：如果你有多个小程序、公众号等，并需要识别是否为同一用户，应该使用 \"),v(\"code\",[_._v(\"unionid\")]),_._v(\" 作为跨应用的统一标识。\")])]),_._v(\" \"),v(\"p\",[_._v(\"总结来说，\"),v(\"code\",[_._v(\"openid\")]),_._v(\" 是微信为了平衡应用的用户识别需求和用户隐私安全，而设计的一套由系统生成、开发者按规则获取的标识符。\")])])}),[],!1,null,null,null);v.default=t.exports},360:function(_,v,e){_.exports=e.p+\"assets/img/image-20251223170812443.bbf49700.png\"},361:function(_,v,e){_.exports=e.p+\"assets/img/image-20251223171508950.6ba535ff.png\"}}]);","extractedComments":[]}