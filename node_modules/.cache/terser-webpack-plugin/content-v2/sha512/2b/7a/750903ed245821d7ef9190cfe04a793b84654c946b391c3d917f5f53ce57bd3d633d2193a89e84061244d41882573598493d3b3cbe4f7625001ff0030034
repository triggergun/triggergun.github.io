{"code":"(window.webpackJsonp=window.webpackJsonp||[]).push([[12],{1229:function(s,a,t){\"use strict\";t.r(a);var e=t(14),r=Object(e.a)({},(function(){var s=this,a=s._self._c;return a(\"ContentSlotsDistributor\",{attrs:{\"slot-key\":s.$parent.slotKey}},[a(\"h1\",{attrs:{id:\"sparkha集群部署\"}},[a(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#sparkha集群部署\"}},[s._v(\"#\")]),s._v(\" SparkHA集群部署\")]),s._v(\" \"),a(\"p\",[s._v(\"上一节是：spark Standalone集群是主从架构的集群模式，因此也存在单节点故障问题。\")]),s._v(\" \"),a(\"p\",[s._v(\"解决：\")]),s._v(\" \"),a(\"p\",[s._v(\"Zookeeper服务，\")]),s._v(\" \"),a(\"p\",[s._v(\"原理：将Standalone集群连接到同一个Zookeeper实例，并启动多个Master节点。利用Zookeeper提供的\"),a(\"font\",{attrs:{color:\"red\"}},[s._v(\"选举\")]),s._v(\"和\"),a(\"font\",{attrs:{color:\"red\"}},[s._v(\"状态保存\")]),s._v(\"功能,可以使一台Master节点被选举出来，另外一台处于Standby状态。\")],1),s._v(\" \"),a(\"p\",[s._v(\"当活着的Master发生故障时，Standby状态的Master要被激活。然后恢复集群调度，这个过程要1~2分钟的时间。\")]),s._v(\" \"),a(\"h2\",{attrs:{id:\"_01-配置zoo-cfg文件\"}},[a(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#_01-配置zoo-cfg文件\"}},[s._v(\"#\")]),s._v(\" 01)配置zoo.cfg文件\")]),s._v(\" \"),a(\"p\",[s._v(\"这个是安装好的第一步要配置的文件。\")]),s._v(\" \"),a(\"div\",{staticClass:\"language-properties line-numbers-mode\"},[a(\"pre\",{pre:!0,attrs:{class:\"language-properties\"}},[a(\"code\",[a(\"span\",{pre:!0,attrs:{class:\"token comment\"}},[s._v(\"# The number of milliseconds of each tick\")]),s._v(\"\\n\"),a(\"span\",{pre:!0,attrs:{class:\"token comment\"}},[s._v(\"# 设置通信心跳数\")]),s._v(\"\\n\"),a(\"span\",{pre:!0,attrs:{class:\"token key attr-name\"}},[s._v(\"tickTime\")]),a(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\"=\")]),a(\"span\",{pre:!0,attrs:{class:\"token value attr-value\"}},[s._v(\"2000\")]),s._v(\"\\n\"),a(\"span\",{pre:!0,attrs:{class:\"token comment\"}},[s._v(\"# The number of ticks that the initial\")]),s._v(\"\\n\"),a(\"span\",{pre:!0,attrs:{class:\"token comment\"}},[s._v(\"# synchronization phase can take\")]),s._v(\"\\n\"),a(\"span\",{pre:!0,attrs:{class:\"token key attr-name\"}},[s._v(\"initLimit\")]),a(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\"=\")]),a(\"span\",{pre:!0,attrs:{class:\"token value attr-value\"}},[s._v(\"10\")]),s._v(\"\\n\"),a(\"span\",{pre:!0,attrs:{class:\"token comment\"}},[s._v(\"# The number of ticks that can pass between\")]),s._v(\"\\n\"),a(\"span\",{pre:!0,attrs:{class:\"token comment\"}},[s._v(\"# sending a request and getting an acknowledgement\")]),s._v(\"\\n\"),a(\"span\",{pre:!0,attrs:{class:\"token key attr-name\"}},[s._v(\"syncLimit\")]),a(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\"=\")]),a(\"span\",{pre:!0,attrs:{class:\"token value attr-value\"}},[s._v(\"5\")]),s._v(\"\\n\"),a(\"span\",{pre:!0,attrs:{class:\"token comment\"}},[s._v(\"# the directory where the snapshot is stored.\")]),s._v(\"\\n\"),a(\"span\",{pre:!0,attrs:{class:\"token comment\"}},[s._v(\"# do not use /tmp for storage, /tmp here is just\")]),s._v(\"\\n\"),a(\"span\",{pre:!0,attrs:{class:\"token comment\"}},[s._v(\"# example sakes.\")]),s._v(\"\\n\\n\"),a(\"span\",{pre:!0,attrs:{class:\"token comment\"}},[s._v(\"# 设置数据文件目录+数据持久化路径\")]),s._v(\"\\n\"),a(\"span\",{pre:!0,attrs:{class:\"token comment\"}},[s._v(\"#dataDir=/tmp/zookeeper\")]),s._v(\"\\n\"),a(\"span\",{pre:!0,attrs:{class:\"token key attr-name\"}},[s._v(\"dataDir\")]),a(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\"=\")]),a(\"span\",{pre:!0,attrs:{class:\"token value attr-value\"}},[s._v(\"/export/data/zookeeper/zkdata\")]),s._v(\"\\n\\n\"),a(\"span\",{pre:!0,attrs:{class:\"token comment\"}},[s._v(\"# the port at which the clients will connect\")]),s._v(\"\\n\"),a(\"span\",{pre:!0,attrs:{class:\"token comment\"}},[s._v(\"# 设置客户端连接的端口号\")]),s._v(\"\\n\"),a(\"span\",{pre:!0,attrs:{class:\"token key attr-name\"}},[s._v(\"clientPort\")]),a(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\"=\")]),a(\"span\",{pre:!0,attrs:{class:\"token value attr-value\"}},[s._v(\"2181\")]),s._v(\"\\n\"),a(\"span\",{pre:!0,attrs:{class:\"token comment\"}},[s._v(\"# the maximum number of client connections.\")]),s._v(\"\\n\"),a(\"span\",{pre:!0,attrs:{class:\"token comment\"}},[s._v(\"# increase this if you need to handle more clients\")]),s._v(\"\\n\"),a(\"span\",{pre:!0,attrs:{class:\"token comment\"}},[s._v(\"#maxClientCnxns=60\")]),s._v(\"\\n\"),a(\"span\",{pre:!0,attrs:{class:\"token comment\"}},[s._v(\"#\")]),s._v(\"\\n\"),a(\"span\",{pre:!0,attrs:{class:\"token comment\"}},[s._v(\"# Be sure to read the maintenance section of the\")]),s._v(\"\\n\"),a(\"span\",{pre:!0,attrs:{class:\"token comment\"}},[s._v(\"# administrator guide before turning on autopurge.\")]),s._v(\"\\n\"),a(\"span\",{pre:!0,attrs:{class:\"token comment\"}},[s._v(\"#\")]),s._v(\"\\n\"),a(\"span\",{pre:!0,attrs:{class:\"token comment\"}},[s._v(\"# http://zookeeper.apache.org/doc/current/zookeeperAdmin.html#sc_maintenance\")]),s._v(\"\\n\"),a(\"span\",{pre:!0,attrs:{class:\"token comment\"}},[s._v(\"#\")]),s._v(\"\\n\"),a(\"span\",{pre:!0,attrs:{class:\"token comment\"}},[s._v(\"# The number of snapshots to retain in dataDir\")]),s._v(\"\\n\"),a(\"span\",{pre:!0,attrs:{class:\"token comment\"}},[s._v(\"#autopurge.snapRetainCount=3\")]),s._v(\"\\n\"),a(\"span\",{pre:!0,attrs:{class:\"token comment\"}},[s._v(\"# Purge task interval in hours\")]),s._v(\"\\n\"),a(\"span\",{pre:!0,attrs:{class:\"token comment\"}},[s._v('# Set to \"0\" to disable auto purge feature')]),s._v(\"\\n\"),a(\"span\",{pre:!0,attrs:{class:\"token comment\"}},[s._v(\"#autopurge.purgeInterval=1\")]),s._v(\"\\n\\n\"),a(\"span\",{pre:!0,attrs:{class:\"token comment\"}},[s._v(\"# 配置Zookeeper集群的服务器编号以及对应的主机名、通信端口号(心跳端口号)和# # 选举端口号。\")]),s._v(\"\\n\"),a(\"span\",{pre:!0,attrs:{class:\"token key attr-name\"}},[s._v(\"server.1\")]),a(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\"=\")]),a(\"span\",{pre:!0,attrs:{class:\"token value attr-value\"}},[s._v(\"hadoop01.2888.3888\")]),s._v(\"\\n\"),a(\"span\",{pre:!0,attrs:{class:\"token key attr-name\"}},[s._v(\"server.2\")]),a(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\"=\")]),a(\"span\",{pre:!0,attrs:{class:\"token value attr-value\"}},[s._v(\"hadoop02.2888.3888\")]),s._v(\"\\n\"),a(\"span\",{pre:!0,attrs:{class:\"token key attr-name\"}},[s._v(\"server.3\")]),a(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\"=\")]),a(\"span\",{pre:!0,attrs:{class:\"token value attr-value\"}},[s._v(\"hadoop03.2888.3888\")]),s._v(\"\\n\")])]),s._v(\" \"),a(\"div\",{staticClass:\"line-numbers-wrapper\"},[a(\"span\",{staticClass:\"line-number\"},[s._v(\"1\")]),a(\"br\"),a(\"span\",{staticClass:\"line-number\"},[s._v(\"2\")]),a(\"br\"),a(\"span\",{staticClass:\"line-number\"},[s._v(\"3\")]),a(\"br\"),a(\"span\",{staticClass:\"line-number\"},[s._v(\"4\")]),a(\"br\"),a(\"span\",{staticClass:\"line-number\"},[s._v(\"5\")]),a(\"br\"),a(\"span\",{staticClass:\"line-number\"},[s._v(\"6\")]),a(\"br\"),a(\"span\",{staticClass:\"line-number\"},[s._v(\"7\")]),a(\"br\"),a(\"span\",{staticClass:\"line-number\"},[s._v(\"8\")]),a(\"br\"),a(\"span\",{staticClass:\"line-number\"},[s._v(\"9\")]),a(\"br\"),a(\"span\",{staticClass:\"line-number\"},[s._v(\"10\")]),a(\"br\"),a(\"span\",{staticClass:\"line-number\"},[s._v(\"11\")]),a(\"br\"),a(\"span\",{staticClass:\"line-number\"},[s._v(\"12\")]),a(\"br\"),a(\"span\",{staticClass:\"line-number\"},[s._v(\"13\")]),a(\"br\"),a(\"span\",{staticClass:\"line-number\"},[s._v(\"14\")]),a(\"br\"),a(\"span\",{staticClass:\"line-number\"},[s._v(\"15\")]),a(\"br\"),a(\"span\",{staticClass:\"line-number\"},[s._v(\"16\")]),a(\"br\"),a(\"span\",{staticClass:\"line-number\"},[s._v(\"17\")]),a(\"br\"),a(\"span\",{staticClass:\"line-number\"},[s._v(\"18\")]),a(\"br\"),a(\"span\",{staticClass:\"line-number\"},[s._v(\"19\")]),a(\"br\"),a(\"span\",{staticClass:\"line-number\"},[s._v(\"20\")]),a(\"br\"),a(\"span\",{staticClass:\"line-number\"},[s._v(\"21\")]),a(\"br\"),a(\"span\",{staticClass:\"line-number\"},[s._v(\"22\")]),a(\"br\"),a(\"span\",{staticClass:\"line-number\"},[s._v(\"23\")]),a(\"br\"),a(\"span\",{staticClass:\"line-number\"},[s._v(\"24\")]),a(\"br\"),a(\"span\",{staticClass:\"line-number\"},[s._v(\"25\")]),a(\"br\"),a(\"span\",{staticClass:\"line-number\"},[s._v(\"26\")]),a(\"br\"),a(\"span\",{staticClass:\"line-number\"},[s._v(\"27\")]),a(\"br\"),a(\"span\",{staticClass:\"line-number\"},[s._v(\"28\")]),a(\"br\"),a(\"span\",{staticClass:\"line-number\"},[s._v(\"29\")]),a(\"br\"),a(\"span\",{staticClass:\"line-number\"},[s._v(\"30\")]),a(\"br\"),a(\"span\",{staticClass:\"line-number\"},[s._v(\"31\")]),a(\"br\"),a(\"span\",{staticClass:\"line-number\"},[s._v(\"32\")]),a(\"br\"),a(\"span\",{staticClass:\"line-number\"},[s._v(\"33\")]),a(\"br\"),a(\"span\",{staticClass:\"line-number\"},[s._v(\"34\")]),a(\"br\"),a(\"span\",{staticClass:\"line-number\"},[s._v(\"35\")]),a(\"br\"),a(\"span\",{staticClass:\"line-number\"},[s._v(\"36\")]),a(\"br\"),a(\"span\",{staticClass:\"line-number\"},[s._v(\"37\")]),a(\"br\"),a(\"span\",{staticClass:\"line-number\"},[s._v(\"38\")]),a(\"br\"),a(\"span\",{staticClass:\"line-number\"},[s._v(\"39\")]),a(\"br\")])]),a(\"h2\",{attrs:{id:\"_02修改spark的spark-env-sh文件\"}},[a(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#_02修改spark的spark-env-sh文件\"}},[s._v(\"#\")]),s._v(\" 02修改spark的spark-env.sh文件\")]),s._v(\" \"),a(\"p\",[s._v(\"之前没有配置HA的配置。\")]),s._v(\" \"),a(\"div\",{staticClass:\"language-properties line-numbers-mode\"},[a(\"pre\",{pre:!0,attrs:{class:\"language-properties\"}},[a(\"code\",[a(\"span\",{pre:!0,attrs:{class:\"token comment\"}},[s._v(\"#JAVA_HOME\")]),s._v(\"\\n\"),a(\"span\",{pre:!0,attrs:{class:\"token key attr-name\"}},[s._v(\"export\")]),s._v(\" \"),a(\"span\",{pre:!0,attrs:{class:\"token value attr-value\"}},[s._v(\"JAVA_HOME=/opt/jdk1.8.0_251\")]),s._v(\"\\n\\n\\n\"),a(\"span\",{pre:!0,attrs:{class:\"token comment\"}},[s._v(\"#配置Master的主机ip\")]),s._v(\"\\n\"),a(\"span\",{pre:!0,attrs:{class:\"token key attr-name\"}},[s._v(\"export\")]),s._v(\" \"),a(\"span\",{pre:!0,attrs:{class:\"token value attr-value\"}},[s._v(\"SPARK_MASTER_HOST=hadoop01\")]),s._v(\"\\n\"),a(\"span\",{pre:!0,attrs:{class:\"token comment\"}},[s._v(\"#配置Master的主机端口\")]),s._v(\"\\n\"),a(\"span\",{pre:!0,attrs:{class:\"token key attr-name\"}},[s._v(\"export\")]),s._v(\" \"),a(\"span\",{pre:!0,attrs:{class:\"token value attr-value\"}},[s._v(\"SPARK_MASTER_PORT=7077\")]),s._v(\"\\n\\n\")])]),s._v(\" \"),a(\"div\",{staticClass:\"line-numbers-wrapper\"},[a(\"span\",{staticClass:\"line-number\"},[s._v(\"1\")]),a(\"br\"),a(\"span\",{staticClass:\"line-number\"},[s._v(\"2\")]),a(\"br\"),a(\"span\",{staticClass:\"line-number\"},[s._v(\"3\")]),a(\"br\"),a(\"span\",{staticClass:\"line-number\"},[s._v(\"4\")]),a(\"br\"),a(\"span\",{staticClass:\"line-number\"},[s._v(\"5\")]),a(\"br\"),a(\"span\",{staticClass:\"line-number\"},[s._v(\"6\")]),a(\"br\"),a(\"span\",{staticClass:\"line-number\"},[s._v(\"7\")]),a(\"br\"),a(\"span\",{staticClass:\"line-number\"},[s._v(\"8\")]),a(\"br\"),a(\"span\",{staticClass:\"line-number\"},[s._v(\"9\")]),a(\"br\")])]),a(\"p\",[s._v(\"HA高可用要配置的.\")]),s._v(\" \"),a(\"p\",[s._v(\"添加 SPARK_DAEMO_ JAVA_OPTS 配置参\")]),s._v(\" \"),a(\"p\",[s._v(\"注释export SPARK_MASTER_HOST=hadoop01【配置文件告诉spark那台启动主节点】\")]),s._v(\" \"),a(\"div\",{staticClass:\"language-properties line-numbers-mode\"},[a(\"pre\",{pre:!0,attrs:{class:\"language-properties\"}},[a(\"code\",[a(\"span\",{pre:!0,attrs:{class:\"token comment\"}},[s._v(\"#JAVA_HOME\")]),s._v(\"\\n\"),a(\"span\",{pre:!0,attrs:{class:\"token key attr-name\"}},[s._v(\"export\")]),s._v(\" \"),a(\"span\",{pre:!0,attrs:{class:\"token value attr-value\"}},[s._v(\"JAVA_HOME=/opt/jdk1.8.0_251\")]),s._v(\"\\n\\n\\n\"),a(\"span\",{pre:!0,attrs:{class:\"token comment\"}},[s._v(\"#配置Master的主机ip\")]),s._v(\"\\n\"),a(\"span\",{pre:!0,attrs:{class:\"token comment\"}},[s._v(\"#export SPARK_MASTER_HOST=hadoop01\")]),s._v(\"\\n\"),a(\"span\",{pre:!0,attrs:{class:\"token comment\"}},[s._v(\"#配置Master的主机端口\")]),s._v(\"\\n\"),a(\"span\",{pre:!0,attrs:{class:\"token key attr-name\"}},[s._v(\"export\")]),s._v(\" \"),a(\"span\",{pre:!0,attrs:{class:\"token value attr-value\"}},[s._v(\"SPARK_MASTER_PORT=7077\")]),s._v(\"\\n\"),a(\"span\",{pre:!0,attrs:{class:\"token key attr-name\"}},[s._v(\"export\")]),s._v(\" \"),a(\"span\",{pre:!0,attrs:{class:\"token value attr-value\"}},[s._v('SPARK_DAEMON_JAVA_OPTS=\"-Dspark.deploy.recoveryMode=ZOOKEEPER -Dspark.deploy.zookeeper.url=hadoop01:2181,hadoop02:2181,hadoop03:2181 -Dspark.deploy.zookeeper.dir=/spark\"')]),s._v(\"\\n\\n\")])]),s._v(\" \"),a(\"div\",{staticClass:\"line-numbers-wrapper\"},[a(\"span\",{staticClass:\"line-number\"},[s._v(\"1\")]),a(\"br\"),a(\"span\",{staticClass:\"line-number\"},[s._v(\"2\")]),a(\"br\"),a(\"span\",{staticClass:\"line-number\"},[s._v(\"3\")]),a(\"br\"),a(\"span\",{staticClass:\"line-number\"},[s._v(\"4\")]),a(\"br\"),a(\"span\",{staticClass:\"line-number\"},[s._v(\"5\")]),a(\"br\"),a(\"span\",{staticClass:\"line-number\"},[s._v(\"6\")]),a(\"br\"),a(\"span\",{staticClass:\"line-number\"},[s._v(\"7\")]),a(\"br\"),a(\"span\",{staticClass:\"line-number\"},[s._v(\"8\")]),a(\"br\"),a(\"span\",{staticClass:\"line-number\"},[s._v(\"9\")]),a(\"br\"),a(\"span\",{staticClass:\"line-number\"},[s._v(\"10\")]),a(\"br\")])]),a(\"p\",[s._v(\"关于上述参数的具体说明如下所示:\")]),s._v(\" \"),a(\"ul\",[a(\"li\",[a(\"p\",[s._v(\"spark.deploy.recoveryMode:设置 Zookeeper 去启动备用 Master 模式\")])]),s._v(\" \"),a(\"li\",[a(\"p\",[s._v(\"spark.deploy.zookeeper.url: 指定 ZooKeeper 的 Server 地址。\")])]),s._v(\" \"),a(\"li\",[a(\"p\",[s._v(\"spark.deploy.zookeeper.dir:保存集群元数据信息的文件和目录\")])])]),s._v(\" \"),a(\"p\",[a(\"img\",{attrs:{src:t(789),alt:\"image-20231028184910264\"}})]),s._v(\" \"),a(\"div\",{staticClass:\"custom-block tip\"},[a(\"p\",{staticClass:\"custom-block-title\"},[s._v(\"总结\")]),s._v(\" \"),a(\"ul\",[a(\"li\",[a(\"p\",[s._v(\"spark的配置要添加这行\")]),s._v(\" \"),a(\"div\",{staticClass:\"language-properties line-numbers-mode\"},[a(\"pre\",{pre:!0,attrs:{class:\"language-properties\"}},[a(\"code\",[a(\"span\",{pre:!0,attrs:{class:\"token key attr-name\"}},[s._v(\"export\")]),s._v(\" \"),a(\"span\",{pre:!0,attrs:{class:\"token value attr-value\"}},[s._v('SPARK_DAEMON_JAVA_OPTS=-Dspark.deploy.recoveryMode=ZOOKEEPER -Dspark.deploy.zookeeper.url=hadoop01:2181,hadoop02:2181,hadoop03:2181 -Dspark.deploy.zookeeper.dir=/spark\"')]),s._v(\"\\n\")])]),s._v(\" \"),a(\"div\",{staticClass:\"line-numbers-wrapper\"},[a(\"span\",{staticClass:\"line-number\"},[s._v(\"1\")]),a(\"br\")])])]),s._v(\" \"),a(\"li\",[a(\"p\",[s._v(\"去掉：\")]),s._v(\" \"),a(\"div\",{staticClass:\"language-properties line-numbers-mode\"},[a(\"pre\",{pre:!0,attrs:{class:\"language-properties\"}},[a(\"code\",[a(\"span\",{pre:!0,attrs:{class:\"token comment\"}},[s._v(\"#配置Master的主机ip\")]),s._v(\"\\n\"),a(\"span\",{pre:!0,attrs:{class:\"token comment\"}},[s._v(\"#export SPARK_MASTER_HOST=hadoop01\")]),s._v(\"\\n\")])]),s._v(\" \"),a(\"div\",{staticClass:\"line-numbers-wrapper\"},[a(\"span\",{staticClass:\"line-number\"},[s._v(\"1\")]),a(\"br\"),a(\"span\",{staticClass:\"line-number\"},[s._v(\"2\")]),a(\"br\")])]),a(\"p\",[s._v(\"这个spark文件修改要注意\")])])])]),s._v(\" \"),a(\"h2\",{attrs:{id:\"_03-分发文件\"}},[a(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#_03-分发文件\"}},[s._v(\"#\")]),s._v(\" 03)分发文件\")]),s._v(\" \"),a(\"p\",[s._v(\"到hadoop02、hadoop03\")]),s._v(\" \"),a(\"div\",{staticClass:\"language-cmd line-numbers-mode\"},[a(\"pre\",{pre:!0,attrs:{class:\"language-text\"}},[a(\"code\",[s._v(\"scp spark-env.sh hadoop02:/opt/spark-2.1.1-bin-hadoop2.7/conf/\\n\\n\")])]),s._v(\" \"),a(\"div\",{staticClass:\"line-numbers-wrapper\"},[a(\"span\",{staticClass:\"line-number\"},[s._v(\"1\")]),a(\"br\"),a(\"span\",{staticClass:\"line-number\"},[s._v(\"2\")]),a(\"br\")])]),a(\"p\",[a(\"img\",{attrs:{src:t(790),alt:\"image-20231028185125530\"}})]),s._v(\" \"),a(\"h2\",{attrs:{id:\"_04-启动高可用集群\"}},[a(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#_04-启动高可用集群\"}},[s._v(\"#\")]),s._v(\" 04)启动高可用集群\")]),s._v(\" \"),a(\"p\",[s._v(\"在普通模式下启动 Spark 集群，只需要通过/spark/sbin/start-all.sh 一键启动脚本即可。然而,在高可用模式下启动 Spark 集群首先需要启动 Zookeeper 集群，然后在任意一台主节点上执行 start-all. sh 命令启动 Spark 集群,最后在另外一台主节点上单独启动Master 服务。具体步骤如下。\")]),s._v(\" \"),a(\"h3\",{attrs:{id:\"启动zookeeper服务\"}},[a(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#启动zookeeper服务\"}},[s._v(\"#\")]),s._v(\" 启动Zookeeper服务\")]),s._v(\" \"),a(\"ol\",[a(\"li\",[s._v(\"依次在3台节点上启动 Zookeeper,命令如下。\")])]),s._v(\" \"),a(\"div\",{staticClass:\"language-cmd line-numbers-mode\"},[a(\"pre\",{pre:!0,attrs:{class:\"language-text\"}},[a(\"code\",[s._v(\"zkServer.sh start\\n\")])]),s._v(\" \"),a(\"div\",{staticClass:\"line-numbers-wrapper\"},[a(\"span\",{staticClass:\"line-number\"},[s._v(\"1\")]),a(\"br\")])]),a(\"p\",[a(\"img\",{attrs:{src:t(791),alt:\"image-20231028191338173\"}})]),s._v(\" \"),a(\"p\",[a(\"img\",{attrs:{src:t(792),alt:\"image-20231028192137611\"}})]),s._v(\" \"),a(\"p\",[a(\"img\",{attrs:{src:t(793),alt:\"image-20231028192157341\"}})]),s._v(\" \"),a(\"h3\",{attrs:{id:\"启动spark集群\"}},[a(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#启动spark集群\"}},[s._v(\"#\")]),s._v(\" 启动Spark集群\")]),s._v(\" \"),a(\"ol\",{attrs:{start:\"2\"}},[a(\"li\",[s._v(\"启动 Spark 集群\")])]),s._v(\" \"),a(\"p\",[s._v(\"在 hadoop01主节点使用一键启动脚本启动，命令如下\")]),s._v(\" \"),a(\"div\",{staticClass:\"language- line-numbers-mode\"},[a(\"pre\",{pre:!0,attrs:{class:\"language-text\"}},[a(\"code\",[s._v(\"xxx/spark/sbin/start-all.sh\\n\")])]),s._v(\" \"),a(\"div\",{staticClass:\"line-numbers-wrapper\"},[a(\"span\",{staticClass:\"line-number\"},[s._v(\"1\")]),a(\"br\")])]),a(\"p\",[a(\"img\",{attrs:{src:t(794),alt:\"image-20231028193656144\"}})]),s._v(\" \"),a(\"h3\",{attrs:{id:\"单独启动master节点\"}},[a(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#单独启动master节点\"}},[s._v(\"#\")]),s._v(\" 单独启动Master节点\")]),s._v(\" \"),a(\"ol\",{attrs:{start:\"3\"}},[a(\"li\",[s._v(\"单独启动 Master 节点。\")])]),s._v(\" \"),a(\"p\",[s._v(\"在 hadoop02节点上再次启动 Master 服务，命令如下\")]),s._v(\" \"),a(\"div\",{staticClass:\"language- line-numbers-mode\"},[a(\"pre\",{pre:!0,attrs:{class:\"language-text\"}},[a(\"code\",[s._v(\"xxx/spark/sbin/start-master.sh\\n\")])]),s._v(\" \"),a(\"div\",{staticClass:\"line-numbers-wrapper\"},[a(\"span\",{staticClass:\"line-number\"},[s._v(\"1\")]),a(\"br\")])]),a(\"p\",[a(\"img\",{attrs:{src:t(795),alt:\"image-20231028193628760\"}})]),s._v(\" \"),a(\"p\",[s._v(\"启动成功后,通过浏览器访问 https://hadoop02;8080,查看备用 Master 节点的状态如图 2-9 所示。\")]),s._v(\" \"),a(\"p\",[s._v(\"hadoop02 节点的状态为 STANDBY,说明 Spark HA 配置完毕\")]),s._v(\" \"),a(\"p\",[a(\"img\",{attrs:{src:t(796),alt:\"image-20231028193826986\"}})]),s._v(\" \"),a(\"p\",[s._v(\"成功部署\")]),s._v(\" \"),a(\"h2\",{attrs:{id:\"_05-测试spark-ha集群\"}},[a(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#_05-测试spark-ha集群\"}},[s._v(\"#\")]),s._v(\" 05)测试Spark HA集群\")]),s._v(\" \"),a(\"p\",[s._v(\"把hadoop01关机\")]),s._v(\" \"),a(\"p\",[a(\"img\",{attrs:{src:t(797),alt:\"image-20231028194203959\"}})]),s._v(\" \"),a(\"p\",[s._v(\"当前时间是：\")]),s._v(\" \"),a(\"p\",[a(\"img\",{attrs:{src:t(798),alt:\"image-20231028194240931\"}})]),s._v(\" \"),a(\"p\",[s._v(\"关机后，看看被用机hadoop启动了maste没。\")]),s._v(\" \"),a(\"p\",[a(\"img\",{attrs:{src:t(799),alt:\"image-20231028194407643\"}})]),s._v(\" \"),a(\"h2\",{attrs:{id:\"写脚本群起zookeeper集群\"}},[a(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#写脚本群起zookeeper集群\"}},[s._v(\"#\")]),s._v(\" 写脚本群起zookeeper集群\")]),s._v(\" \"),a(\"p\",[s._v(\"在集群中启动 Zookeeper 服务时，需要依次在3台服务器上执行启动命令，然而在实工作应用中，集群数量并非3台,当遇到数十台甚至更多的服务器时，就不得不编写脚本来启动服务了，编写脚本的语言有多种，这里采用 Shell 语言开发一键启动 Zookeeper 服务别本，使用vi创建 start_zk.sh 文件，如下:\")]),s._v(\" \"),a(\"div\",{staticClass:\"language- line-numbers-mode\"},[a(\"pre\",{pre:!0,attrs:{class:\"language-text\"}},[a(\"code\",[s._v(\"\\n\")])]),s._v(\" \"),a(\"div\",{staticClass:\"line-numbers-wrapper\"},[a(\"span\",{staticClass:\"line-number\"},[s._v(\"1\")]),a(\"br\")])]),a(\"p\",[s._v(\"在book page 42\")]),s._v(\" \"),a(\"h2\",{attrs:{id:\"扩展实验\"}},[a(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#扩展实验\"}},[s._v(\"#\")]),s._v(\" 扩展实验\")]),s._v(\" \"),a(\"p\",[s._v(\"上面的HA集群展示了一个节点挂了，有候补上，集群调度没有受到影响。实现了高可用集群。\")]),s._v(\" \"),a(\"h3\",{attrs:{id:\"实验一\"}},[a(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#实验一\"}},[s._v(\"#\")]),s._v(\" 实验一\")]),s._v(\" \"),a(\"ul\",[a(\"li\",[s._v(\"spark故障后怎么回复集群呢？\")])]),s._v(\" \"),a(\"p\",[a(\"strong\",[s._v(\"实验遇到的问题\")])]),s._v(\" \"),a(\"p\",[s._v(\"spark怎么单独启动work集群？\")]),s._v(\" \"),a(\"p\",[a(\"strong\",[s._v(\"实验操作步骤\")])]),s._v(\" \"),a(\"p\",[s._v(\"第一步：查看hadoop02集群的spark节点\")]),s._v(\" \"),a(\"p\",[a(\"img\",{attrs:{src:t(800),alt:\"image-20231028200031413\"}})]),s._v(\" \"),a(\"div\",{staticClass:\"language- line-numbers-mode\"},[a(\"pre\",{pre:!0,attrs:{class:\"language-text\"}},[a(\"code\",[s._v(\"./start-slave.sh spark://hadoop02:7077\\n\")])]),s._v(\" \"),a(\"div\",{staticClass:\"line-numbers-wrapper\"},[a(\"span\",{staticClass:\"line-number\"},[s._v(\"1\")]),a(\"br\")])]),a(\"p\",[a(\"img\",{attrs:{src:t(801),alt:\"image-20231028200142204\"}})]),s._v(\" \"),a(\"p\",[a(\"img\",{attrs:{src:t(802),alt:\"image-20231028200203705\"}})]),s._v(\" \"),a(\"p\",[s._v(\"单独启动hadoop01的master\")]),s._v(\" \"),a(\"div\",{staticClass:\"language-cmd line-numbers-mode\"},[a(\"pre\",{pre:!0,attrs:{class:\"language-text\"}},[a(\"code\",[s._v(\"/sbin/start-master.sh\\n\")])]),s._v(\" \"),a(\"div\",{staticClass:\"line-numbers-wrapper\"},[a(\"span\",{staticClass:\"line-number\"},[s._v(\"1\")]),a(\"br\")])]),a(\"p\",[a(\"img\",{attrs:{src:t(803),alt:\"image-20231028200441800\"}})]),s._v(\" \"),a(\"p\",[s._v(\"hadoop02关机\")]),s._v(\" \"),a(\"p\",[a(\"img\",{attrs:{src:t(804),alt:\"image-20231028200600657\"}})]),s._v(\" \"),a(\"p\",[s._v(\"实验结论：\")]),s._v(\" \"),a(\"p\",[s._v(\"启动master: 日志和web ui，观察master url\\n./start-master.sh\\n启动worker: 观察web ui，是否有新加入的worker节点，以及对应的信息\\n./start-slave.sh spark://spark-project-1:7077\\n单独关闭master和worker，顺序得反过来，先关worker，再关master\\n./stop-slave.sh\\n./stop-master.sh\\n再次单独启动master和worker，给worker限定--memory参数，就使用500m内存，再到web ui，跟之前看到的worker信息比对一下内存最大使用量\\n./start-master.sh\\n./start-slave.sh spark://spark-project-1:7077 --memory 500m\\n集体关闭集群，再启动集群，保证后面可以正常使用\\n./stop-all.sh\\n./start-all.sh\")]),s._v(\" \"),a(\"h2\",{attrs:{id:\"报错\"}},[a(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#报错\"}},[s._v(\"#\")]),s._v(\" 报错\")]),s._v(\" \"),a(\"h3\",{attrs:{id:\"问题一\"}},[a(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#问题一\"}},[s._v(\"#\")]),s._v(\" 问题一\")]),s._v(\" \"),a(\"p\",[s._v(\"在hadoop单独启动集群时报错\")]),s._v(\" \"),a(\"div\",{staticClass:\"language-cmd line-numbers-mode\"},[a(\"pre\",{pre:!0,attrs:{class:\"language-text\"}},[a(\"code\",[s._v(\"[root@hadoop02 spark-2.1.1-bin-hadoop2.7]# sbin/start-master.sh\\nstarting org.apache.spark.deploy.master.Master, logging to /opt/spark-2.1.1-bin-hadoop2.7/logs/spark-root-org.apache.spark.deploy.master.Master-1-hadoop02.out\\nfailed to launch: nice -n 0 /opt/spark-2.1.1-bin-hadoop2.7/bin/spark-class org.apache.spark.deploy.master.Master --host hadoop02 --port 7077 --webui-port 8080\\n  Error: Could not create the Java Virtual Machine.\\n  Error: A fatal exception has occurred. Program will exit.\\nfull log in /opt/spark-2.1.1-bin-hadoop2.7/logs/spark-root-org.apache.spark.deploy.master.Master-1-hadoop02.ou\\n\")])]),s._v(\" \"),a(\"div\",{staticClass:\"line-numbers-wrapper\"},[a(\"span\",{staticClass:\"line-number\"},[s._v(\"1\")]),a(\"br\"),a(\"span\",{staticClass:\"line-number\"},[s._v(\"2\")]),a(\"br\"),a(\"span\",{staticClass:\"line-number\"},[s._v(\"3\")]),a(\"br\"),a(\"span\",{staticClass:\"line-number\"},[s._v(\"4\")]),a(\"br\"),a(\"span\",{staticClass:\"line-number\"},[s._v(\"5\")]),a(\"br\"),a(\"span\",{staticClass:\"line-number\"},[s._v(\"6\")]),a(\"br\")])]),a(\"p\",[s._v(\"分析：\")]),s._v(\" \"),a(\"ul\",[a(\"li\",[s._v(\"配置文件错误。本人遇到的。\")])])])}),[],!1,null,null,null);a.default=r.exports},789:function(s,a,t){s.exports=t.p+\"assets/img/image-20231028184910264.e8fb37ab.png\"},790:function(s,a,t){s.exports=t.p+\"assets/img/image-20231028185125530.1a9a8e1d.png\"},791:function(s,a,t){s.exports=t.p+\"assets/img/image-20231028191338173.72ec549f.png\"},792:function(s,a,t){s.exports=t.p+\"assets/img/image-20231028192137611.b912a342.png\"},793:function(s,a,t){s.exports=t.p+\"assets/img/image-20231028192157341.9bd29590.png\"},794:function(s,a,t){s.exports=t.p+\"assets/img/image-20231028193656144.926f4c3b.png\"},795:function(s,a,t){s.exports=t.p+\"assets/img/image-20231028193628760.0dcf672e.png\"},796:function(s,a,t){s.exports=t.p+\"assets/img/image-20231028193826986.408e495d.png\"},797:function(s,a,t){s.exports=t.p+\"assets/img/image-20231028194203959.7efefbb7.png\"},798:function(s,a,t){s.exports=t.p+\"assets/img/image-20231028194240931.87b8031d.png\"},799:function(s,a,t){s.exports=t.p+\"assets/img/image-20231028194407643.a08959c4.png\"},800:function(s,a,t){s.exports=t.p+\"assets/img/image-20231028200031413.ebbdb7fc.png\"},801:function(s,a,t){s.exports=t.p+\"assets/img/image-20231028200142204.f383a88f.png\"},802:function(s,a,t){s.exports=t.p+\"assets/img/image-20231028200203705.eec8acdf.png\"},803:function(s,a,t){s.exports=t.p+\"assets/img/image-20231028200441800.ba262dcf.png\"},804:function(s,a,t){s.exports=t.p+\"assets/img/image-20231028200600657.560ae7ea.png\"}}]);","extractedComments":[]}