{"code":"(window.webpackJsonp=window.webpackJsonp||[]).push([[96],{1251:function(s,t,a){\"use strict\";a.r(t);var n=a(14),e=Object(n.a)({},(function(){var s=this,t=s._self._c;return t(\"ContentSlotsDistributor\",{attrs:{\"slot-key\":s.$parent.slotKey}},[t(\"h1\",{attrs:{id:\"注册新用户的业务要点说明-4-6\"}},[t(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#注册新用户的业务要点说明-4-6\"}},[s._v(\"#\")]),s._v(\" 注册新用户的业务要点说明[4-6]\")]),s._v(\" \"),t(\"ul\",[t(\"li\",[s._v(\"为什么可以使用微信账号登入？\")])]),s._v(\" \"),t(\"p\",[s._v(\"微信账号登入，小程序点击注册的按钮就是把用户的微信的账号与员工的账号绑定在一起。\")]),s._v(\" \"),t(\"ul\",[t(\"li\",[s._v(\"小程序端要做什么？\")])]),s._v(\" \"),t(\"p\",[s._v(\"小程序要提取微信的用户信息。然后提交给后端的java程序，java程序将这个数据保存在数据库表里面。然后下一次用户就可以使用微信账号进行登入。\")]),s._v(\" \"),t(\"ul\",[t(\"li\",[s._v(\"前一节回顾。\")])]),s._v(\" \"),t(\"p\",[s._v(\"上节课我们设计好了注册页面的内容，这节课我们编写JS代码，获取到用户的注册信息，后续的小节，我们会把注册信息提交给后端Java项目，完成新用户注册。\")]),s._v(\" \"),t(\"h2\",{attrs:{id:\"_01-激活码有什么用途\"}},[t(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#_01-激活码有什么用途\"}},[s._v(\"#\")]),s._v(\" 01)激活码有什么用途？\")]),s._v(\" \"),t(\"p\",[s._v(\"首先大家要知道Emos系统并不是完全对外开放的在线办公系统，只有\"),t(\"font\",{attrs:{color:\"red\"}},[s._v(\"本公司内部人员\")]),s._v(\"才可以使用这套系统，所以Emos系统并不完全对外开放注册。\")],1),s._v(\" \"),t(\"p\",[t(\"img\",{attrs:{src:a(755),alt:\"image-20231003171840951\"}})]),s._v(\" \"),t(\"ol\",[t(\"li\",[s._v(\"当管理者在Emos系统中创建了新员工记录，然后Emos系统会自动向新员工的邮箱发出Email邮件，邮件中就包含了激活码。\")]),s._v(\" \"),t(\"li\",[s._v(\"当新员工打开Emos小程序之后，在注册页面填写上激活码，于是用户的微信账号就自动跟Emos系统绑定了。\")]),s._v(\" \"),t(\"li\",[s._v(\"以后登录Emos系统的时候，只需要在微信上确认一下，就可以完成登陆。\")])]),s._v(\" \"),t(\"ul\",[t(\"li\",[s._v(\"超级管理员的作用。\")])]),s._v(\" \"),t(\"p\",[s._v(\"我设计的Emos系统包含一个内置的超级管理员账号，这个账号的激活码是固定的（默认000000）。公司部署好Emos系统之后，管理者在Emos小程序注册页面填写这个\"),t(\"strong\",[s._v(\"固定的激活码\")]),s._v(\"，然后就可以让自己的微信账号和超级管理员账号绑定在一起。Emos系统中的超级管理员只有一个，也就是说只能绑定一个微信账号。\")]),s._v(\" \"),t(\"h2\",{attrs:{id:\"_02-激活码的过期时间\"}},[t(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#_02-激活码的过期时间\"}},[s._v(\"#\")]),s._v(\" 02)激活码的过期时间\")]),s._v(\" \"),t(\"p\",[s._v(\"激活码是有过期时间的，它的过期时间就是Redis的过期时间。管理者在Emos系统上面创建新员工帐户之后，Emos系统会把激活码缓存到Redis上面，过期的时候Redis会自动删除缓存的激活码。\")]),s._v(\" \"),t(\"p\",[s._v(\"激活码什么时候保存到redis数据库里面？\")]),s._v(\" \"),t(\"ul\",[t(\"li\",[s._v(\"创建新员工帐户之后  ==》 Emos系统会把激活码缓存到Redis上面==》 入库\")])]),s._v(\" \"),t(\"p\",[s._v(\"自动删除缓存数据？\")]),s._v(\" \"),t(\"ul\",[t(\"li\",[s._v(\"过期 ==》 删除缓存\")])]),s._v(\" \"),t(\"h2\",{attrs:{id:\"_03-新员工帐户与微信绑定\"}},[t(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#_03-新员工帐户与微信绑定\"}},[s._v(\"#\")]),s._v(\" 03)新员工帐户与微信绑定\")]),s._v(\" \"),t(\"p\",[s._v(\"如果每个员工的记录跟微信帐户绑定的话，那么每名员工登陆的时候，直接在微信上确认就可以登录Emos系统了。\")]),s._v(\" \"),t(\"p\",[t(\"img\",{attrs:{src:a(756),alt:\"image-20231003172716303\"}})]),s._v(\" \"),t(\"p\",[s._v(\"管理者在创建新员工记录的时候，并不知道新员工的微信账号，所以没办法完成绑定，需要新员工自己完成绑定。于是新员工在Emos小程序注册页面，填写激活码之后，Emos小程序获取新员工的微信账号信息，提交给Emos后台系统，后端系统把微信账号与新员工账号关联在一起，然后保存到MySQL数据库。\")]),s._v(\" \"),t(\"p\",[t(\"img\",{attrs:{src:a(757),alt:\"image-20231003172830018\"}})]),s._v(\" \"),t(\"p\",[s._v(\"其实把微信账号与小程序关联在一起很简单，就是把微信基本信息（呢称、头像）和openId，存储到员工记录上面。因为每个微信账号的openId在当前的小程序上面都是唯一的，只要MySQL记录下每名员工微信账号的openId，那么就实现了\"),t(\"font\",{attrs:{color:\"red\"}},[s._v(\"员工记录与微信账号\")]),s._v(\"的绑定。\")],1),s._v(\" \"),t(\"h2\",{attrs:{id:\"_04-如何获取微信账号的openld字符串-后端获取\"}},[t(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#_04-如何获取微信账号的openld字符串-后端获取\"}},[s._v(\"#\")]),s._v(\" 04)如何获取微信账号的Openld字符串？[后端获取]\")]),s._v(\" \"),t(\"p\",[s._v(\"首先我们可以从微信APP上面获得用户临时授权字符串\"),t(\"font\",{attrs:{color:\"red\"}},[s._v(\"（code）\")]),s._v(\"，然后把这个字符串传递给后端Java系统，让Java系统拿着\"),t(\"font\",{attrs:{color:\"red\"}},[s._v(\"AppId\")]),s._v(\"、\"),t(\"font\",{attrs:{color:\"red\"}},[s._v(\"密钥\")]),s._v(\"和\"),t(\"font\",{attrs:{color:\"red\"}},[s._v(\"Code\")]),s._v(\"，提交给\"),t(\"font\",{attrs:{color:\"blue\"}},[s._v(\"微信平台\")]),s._v(\"换取\"),t(\"font\",{attrs:{color:\"red\"}},[s._v(\"OpenId\")])],1),s._v(\" \"),t(\"div\",{staticClass:\"language-java line-numbers-mode\"},[t(\"pre\",{pre:!0,attrs:{class:\"language-java\"}},[t(\"code\",[t(\"span\",{pre:!0,attrs:{class:\"token class-name\"}},[s._v(\"String\")]),s._v(\" url  \"),t(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[s._v(\"=\")]),s._v(\" \"),t(\"span\",{pre:!0,attrs:{class:\"token string\"}},[s._v('\"https://api.weixin.qq.com/sns/jscode2session\"')]),t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\";\")]),s._v(\"\\n\"),t(\"span\",{pre:!0,attrs:{class:\"token class-name\"}},[s._v(\"HashMap\")]),s._v(\" map \"),t(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[s._v(\"=\")]),s._v(\" \"),t(\"span\",{pre:!0,attrs:{class:\"token keyword\"}},[s._v(\"new\")]),s._v(\" \"),t(\"span\",{pre:!0,attrs:{class:\"token class-name\"}},[s._v(\"HashMap\")]),t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\"(\")]),t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\")\")]),t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\";\")]),s._v(\"\\nmap\"),t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\".\")]),t(\"span\",{pre:!0,attrs:{class:\"token function\"}},[s._v(\"put\")]),t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\"(\")]),t(\"span\",{pre:!0,attrs:{class:\"token string\"}},[s._v('\"appid\"')]),t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\",\")]),s._v(\"appId\"),t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\")\")]),t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\";\")]),t(\"span\",{pre:!0,attrs:{class:\"token comment\"}},[s._v(\"// 微信小程序的appid\")]),s._v(\"\\n\"),t(\"span\",{pre:!0,attrs:{class:\"token function\"}},[s._v(\"mapput\")]),t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\"(\")]),s._v('“secret\"'),t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\",\")]),s._v(\" appSecret\"),t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\")\")]),t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\";\")]),s._v(\"  \"),t(\"span\",{pre:!0,attrs:{class:\"token comment\"}},[s._v(\"// 小程序的密钥\")]),s._v(\"\\nmap\"),t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\".\")]),t(\"span\",{pre:!0,attrs:{class:\"token function\"}},[s._v(\"put\")]),t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\"(\")]),t(\"span\",{pre:!0,attrs:{class:\"token string\"}},[s._v('\"js_code\"')]),t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\",\")]),s._v(\" code\"),t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\")\")]),t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\";\")]),t(\"span\",{pre:!0,attrs:{class:\"token comment\"}},[s._v(\"//微信账号的零时授权\")]),s._v(\"\\nmap\"),t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\".\")]),t(\"span\",{pre:!0,attrs:{class:\"token function\"}},[s._v(\"put\")]),t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\"(\")]),t(\"span\",{pre:!0,attrs:{class:\"token string\"}},[s._v('\"grant_type\"')]),t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\",\")]),t(\"span\",{pre:!0,attrs:{class:\"token string\"}},[s._v('\"authorization_code\"')]),t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\")\")]),t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\";\")]),s._v(\"\\n       \\n       \\n\"),t(\"span\",{pre:!0,attrs:{class:\"token comment\"}},[s._v(\"// post请求：map是参数     \")]),s._v(\"\\n\"),t(\"span\",{pre:!0,attrs:{class:\"token class-name\"}},[s._v(\"String\")]),s._v(\" response \"),t(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[s._v(\"=\")]),s._v(\" \"),t(\"span\",{pre:!0,attrs:{class:\"token class-name\"}},[s._v(\"Httputil\")]),s._v(\"·\"),t(\"span\",{pre:!0,attrs:{class:\"token function\"}},[s._v(\"post\")]),t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\"(\")]),s._v(\"url\"),t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\",\")]),s._v(\"map\"),t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\")\")]),t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\";\")]),s._v(\"\\n       \\n\"),t(\"span\",{pre:!0,attrs:{class:\"token comment\"}},[s._v(\"// 解析响应为:json对象\")]),s._v(\"\\n\"),t(\"span\",{pre:!0,attrs:{class:\"token class-name\"}},[s._v(\"JSONobject\")]),s._v(\" json \"),t(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[s._v(\"=\")]),s._v(\" \"),t(\"span\",{pre:!0,attrs:{class:\"token class-name\"}},[s._v(\"JSONUtil\")]),t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\".\")]),t(\"span\",{pre:!0,attrs:{class:\"token function\"}},[s._v(\"parseobj\")]),t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\"(\")]),s._v(\"response\"),t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\")\")]),t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\";\")]),s._v(\"\\n       \\n\"),t(\"span\",{pre:!0,attrs:{class:\"token comment\"}},[s._v(\"// 获取openid属性\")]),s._v(\"\\n\"),t(\"span\",{pre:!0,attrs:{class:\"token class-name\"}},[s._v(\"String\")]),s._v(\" openId \"),t(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[s._v(\"=\")]),s._v(\" json\"),t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\".\")]),t(\"span\",{pre:!0,attrs:{class:\"token function\"}},[s._v(\"getStr\")]),t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\"(\")]),s._v('“openid\"'),t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\")\")]),t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\";\")]),s._v(\"\\n\\n\")])]),s._v(\" \"),t(\"div\",{staticClass:\"line-numbers-wrapper\"},[t(\"span\",{staticClass:\"line-number\"},[s._v(\"1\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"2\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"3\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"4\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"5\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"6\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"7\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"8\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"9\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"10\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"11\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"12\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"13\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"14\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"15\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"16\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"17\")]),t(\"br\")])]),t(\"p\",[s._v(\"参数来源说明：\")]),s._v(\" \"),t(\"ul\",[t(\"li\",[s._v(\"code：是小程序传递过来的。\")])]),s._v(\" \"),t(\"h2\",{attrs:{id:\"什么是openid呢\"}},[t(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#什么是openid呢\"}},[s._v(\"#\")]),s._v(\" 什么是openId呢？\")]),s._v(\" \"),t(\"ul\",[t(\"li\",[s._v(\"openId的字符串是怎么来的呢？\")])]),s._v(\" \"),t(\"p\",[s._v(\"答：【微信账号的id + 商户的小程序的appid + 密钥】+密算法之后生成的字符串【这个字符串就是openid】。\")]),s._v(\" \"),t(\"p\",[s._v(\"反之：我们不可以使用openId字符串反推回 【微信账号的id + 商户的小程序的appid + 密钥】\")]),s._v(\" \"),t(\"div\",{staticClass:\"custom-block tip\"},[t(\"p\",{staticClass:\"custom-block-title\"},[s._v(\"总结\")]),s._v(\" \"),t(\"ol\",[t(\"li\",[s._v(\"微信平台不想让我们知道微信账号的id。\")]),s._v(\" \"),t(\"li\",[s._v(\"微信平台只能让我们得到微信的openid，得不到微信账号的id。\")])]),s._v(\" \"),t(\"p\",[s._v(\"没有其他办法吗？\")])]),s._v(\" \"),t(\"ul\",[t(\"li\",[s._v(\"openid的作用是什么呢？\")])]),s._v(\" \"),t(\"ol\",[t(\"li\",[s._v(\"区别微信账号。\")])])])}),[],!1,null,null,null);t.default=e.exports},755:function(s,t,a){s.exports=a.p+\"assets/img/image-20231003171840951.550411ee.png\"},756:function(s,t,a){s.exports=a.p+\"assets/img/image-20231003172716303.9b79968d.png\"},757:function(s,t,a){s.exports=a.p+\"assets/img/image-20231003172830018.769774c0.png\"}}]);","extractedComments":[]}