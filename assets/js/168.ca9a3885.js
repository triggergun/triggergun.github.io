(window.webpackJsonp=window.webpackJsonp||[]).push([[168],{1873:function(s,a,t){"use strict";t.r(a);var n=t(18),r=Object(n.a)({},(function(){var s=this,a=s._self._c;return a("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[a("h1",{attrs:{id:"在golang中使用xorm操作数据库"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#在golang中使用xorm操作数据库"}},[s._v("#")]),s._v(" 在golang中使用xorm操作数据库")]),s._v(" "),a("h2",{attrs:{id:"学习目标"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#学习目标"}},[s._v("#")]),s._v(" 学习目标")]),s._v(" "),a("ul",[a("li",[s._v("xorm的安装")]),s._v(" "),a("li",[s._v("Xorm的初始化")]),s._v(" "),a("li",[s._v("用xorm实现curd")])]),s._v(" "),a("h2",{attrs:{id:"xorm的安装"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#xorm的安装"}},[s._v("#")]),s._v(" xorm的安装")]),s._v(" "),a("ol",[a("li",[s._v("安装相应的依赖包。")])]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("go get github.com/go-xorm/xorm\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("ol",{attrs:{start:"2"}},[a("li",[s._v("安装mysql的驱动依赖。")])]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("go get github.com/go-sql-driver/mysql\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("div",{staticClass:"custom-block tip"},[a("p",{staticClass:"custom-block-title"},[s._v("提问环节")]),s._v(" "),a("p",[s._v("go get github.com/go-xorm/xorm 这个安装的依赖包安装到电脑那个位置下去了呢？")]),s._v(" "),a("ul",[a("li",[s._v("使用 Go Modules 时，依赖安装到 "),a("code",[s._v("$GOPATH/pkg/mod")]),s._v("。")]),s._v(" "),a("li",[s._v("未使用 Go Modules 时，依赖安装到 "),a("code",[s._v("$GOPATH/src")]),s._v("。")])])]),s._v(" "),a("h2",{attrs:{id:"xorm的初始化"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#xorm的初始化"}},[s._v("#")]),s._v(" Xorm的初始化")]),s._v(" "),a("p",[s._v("定义模型层")]),s._v(" "),a("div",{staticClass:"language-go line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-go"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("package")]),s._v(" model\n\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("import")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"time"')]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("const")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("\n\tSEX_WOMEN "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"W"')]),s._v("\n\tSEX_MEN   "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"M"')]),s._v("\n\t"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//")]),s._v("\n\tSEX_UNKNOW "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"U"')]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("type")]),s._v(" User "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("struct")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n\t"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//用户ID")]),s._v("\n\tId "),a("span",{pre:!0,attrs:{class:"token builtin"}},[s._v("int64")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('`xorm:"pk autoincr bigint(20)" form:"id" json:"id"`')]),s._v("\n\t"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//手机号")]),s._v("\n\tMobile "),a("span",{pre:!0,attrs:{class:"token builtin"}},[s._v("string")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('`xorm:"varchar(20)" form:"mobile" json:"mobile"`')]),s._v("\n\t"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 用户密码 = （passwd + salt） 使用 MD5")]),s._v("\n\tPasswd "),a("span",{pre:!0,attrs:{class:"token builtin"}},[s._v("string")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('`xorm:"varchar(40)" form:"passwd" json:"-"`')]),s._v("\n\t"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 头像")]),s._v("\n\tAvatar "),a("span",{pre:!0,attrs:{class:"token builtin"}},[s._v("string")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('`xorm:"varchar(150)" form:"avatar" json:"avatar"`')]),s._v("\n\tSex    "),a("span",{pre:!0,attrs:{class:"token builtin"}},[s._v("string")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('`xorm:"varchar(2)" form:"sex" json:"sex"`')]),s._v("\n\t"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 名称")]),s._v("\n\tNickname "),a("span",{pre:!0,attrs:{class:"token builtin"}},[s._v("string")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('`xorm:"varchar(20)" form:"nickname" json:"nickname"`')]),s._v("\n\t"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//加盐随机字符串")]),s._v("\n\tSalt   "),a("span",{pre:!0,attrs:{class:"token builtin"}},[s._v("string")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('`xorm:"varchar(10)" form:"salt" json:"-"`')]),s._v("    "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 什么角色")]),s._v("\n\tOnline "),a("span",{pre:!0,attrs:{class:"token builtin"}},[s._v("int")]),s._v("    "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('`xorm:"int(10)" form:"online" json:"online"`')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//是否在线")]),s._v("\n\t"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//前端鉴权因子,   一样鉴权 通过过。不一样鉴权失败。")]),s._v("\n\tToken    "),a("span",{pre:!0,attrs:{class:"token builtin"}},[s._v("string")]),s._v("    "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('`xorm:"varchar(40)" form:"token" json:"token"`')]),s._v("\n\tMemo     "),a("span",{pre:!0,attrs:{class:"token builtin"}},[s._v("string")]),s._v("    "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('`xorm:"varchar(140)" form:"memo" json:"memo"`')]),s._v("\n\tCreateat time"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("Time "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('`xorm:"datetime" form:"createat" json:"createat"`')]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br"),a("span",{staticClass:"line-number"},[s._v("26")]),a("br"),a("span",{staticClass:"line-number"},[s._v("27")]),a("br"),a("span",{staticClass:"line-number"},[s._v("28")]),a("br"),a("span",{staticClass:"line-number"},[s._v("29")]),a("br"),a("span",{staticClass:"line-number"},[s._v("30")]),a("br"),a("span",{staticClass:"line-number"},[s._v("31")]),a("br"),a("span",{staticClass:"line-number"},[s._v("32")]),a("br")])]),a("p",[s._v("定义服务层")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("https://gitea.com/xorm/builder\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("go get xorm.io/builder\ngo get xorm.io/xorm\ngo get xorm.io/core\ngo get xorm.io/log\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br")])]),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("go get github.com/golang/snappy\ngo get xorm.io/xorm\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("h2",{attrs:{id:"自动创建表结构"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#自动创建表结构"}},[s._v("#")]),s._v(" 自动创建表结构")]),s._v(" "),a("p",[s._v("下面是自动创建user对象的表结构输出日志。")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("[xorm] [info]  2025/03/24 10:18:47.757207 [SQL] SELECT `TABLE_NAME`, `ENGINE`, `TABLE_ROWS`, `AUTO_INCREMENT`, `TABLE_COMMENT` from `INFORMATION_SCHEMA`.`TABLES` WHERE `TABLE_SCHEMA`=? AND (`ENGINE`='MyISAM' OR `ENGINE` = 'InnoDB' OR `ENGINE` = 'TokuDB') [chat]\ninit data base ok\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("p",[s._v("上面的日志是没有先在数据库中创建chat库。")]),s._v(" "),a("p",[s._v("下面的日志是数据库已经准备了chat的数据库。")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("[xorm] [info]  2025/03/24 10:24:04.245633 [SQL] SELECT `TABLE_NAME`, `ENGINE`, `TABLE_ROWS`, `AUTO_INCREMENT`, `TABLE_COMMENT` from `INFORMATION_SCHEMA`.`TABLES` WHERE `TABLE_SCHEMA`=? AND (`ENGINE`='MyISAM' OR `ENGINE` = 'InnoDB' OR `ENGINE` = 'TokuDB') [chat]\n[xorm] [info]  2025/03/24 10:24:04.283731 [SQL] CREATE TABLE IF NOT EXISTS `user` (`id` BIGINT(20) PRIMARY KEY AUTO_INCREMENT NOT NULL, `mobile` VARCHAR(20) NULL, `passwd` VARCHAR(40) NULL, `avatar` VARCHAR(150) NULL, `sex` VARCHAR(2) NULL, `nickname` VARCHAR(20) NULL, `salt` VARCHAR(10) NULL, `online` INT(10) NULL, `token` VARCHAR(40) NULL, `memo` VARCHAR(140) NULL, `createat` DATETIME NULL) DEFAULT CHARSET utf8\ninit data base ok\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br")])]),a("p",[s._v("自动创建表结构效果如下验证：")]),s._v(" "),a("p",[a("img",{attrs:{src:t(806),alt:"image-20250324102454590"}})]),s._v(" "),a("h2",{attrs:{id:"测试案例"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#测试案例"}},[s._v("#")]),s._v(" 测试案例")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v('curl http://127.0.0.1:8080/user/register -d "mobile=19970694323&passwd=123456"\n')])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("h2",{attrs:{id:"相关问题"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#相关问题"}},[s._v("#")]),s._v(" 相关问题")]),s._v(" "),a("p",[s._v("启动项目的时候，安装的依赖无法解析。")]),s._v(" "),a("p",[a("img",{attrs:{src:t(807),alt:"image-20250324100402574"}})]),s._v(" "),a("p",[s._v("如上图这些依赖。无法解析。程序启动的时候各种问题的报错。")]),s._v(" "),a("p",[s._v("解决办法：")]),s._v(" "),a("p",[s._v("使用最新版的go编译器。注意：不是依赖源代码的问题。是go编译器的版本问题。使用最新版就能解决问题。")])])}),[],!1,null,null,null);a.default=r.exports},806:function(s,a,t){s.exports=t.p+"assets/img/image-20250324102454590.c28ee5bf.png"},807:function(s,a,t){s.exports=t.p+"assets/img/image-20250324100402574.3dd8ba31.png"}}]);