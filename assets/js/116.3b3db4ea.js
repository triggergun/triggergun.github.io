(window.webpackJsonp=window.webpackJsonp||[]).push([[116],{1936:function(t,s,a){"use strict";a.r(s);var n=a(18),e=Object(n.a)({},(function(){var t=this,s=t._self._c;return s("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[s("h1",{attrs:{id:"设计一个mi聊天系统"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#设计一个mi聊天系统"}},[t._v("#")]),t._v(" 设计一个MI聊天系统")]),t._v(" "),s("h2",{attrs:{id:"数据存储结构设计"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#数据存储结构设计"}},[t._v("#")]),t._v(" 数据存储结构设计")]),t._v(" "),s("p",[s("img",{attrs:{src:a(352),alt:"image-20250503185512868"}})]),t._v(" "),s("h2",{attrs:{id:"接收客户端消息处理逻辑"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#接收客户端消息处理逻辑"}},[t._v("#")]),t._v(" 接收客户端消息处理逻辑")]),t._v(" "),s("p",[s("img",{attrs:{src:a(353),alt:"image-20250503185559371"}})]),t._v(" "),s("h2",{attrs:{id:"发送消息处理设计"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#发送消息处理设计"}},[t._v("#")]),t._v(" 发送消息处理设计")]),t._v(" "),s("p",[s("img",{attrs:{src:a(354),alt:"image-20250503185718102"}})]),t._v(" "),s("h2",{attrs:{id:"接收消息处理设计"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#接收消息处理设计"}},[t._v("#")]),t._v(" 接收消息处理设计")]),t._v(" "),s("p",[s("img",{attrs:{src:a(355),alt:"image-20250503185814443"}})]),t._v(" "),s("h2",{attrs:{id:"消息体设计"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#消息体设计"}},[t._v("#")]),t._v(" 消息体设计")]),t._v(" "),s("div",{staticClass:"language-go line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-go"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("type")]),t._v(" Message "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("struct")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\tId      "),s("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("int64")]),t._v("  "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('`json:"id,omitempty" form:"id"`')]),t._v("           "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//消息ID")]),t._v("\n\tUserid  "),s("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("int64")]),t._v("  "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('`json:"userid,omitempty" form:"userid"`')]),t._v("   "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//谁发的")]),t._v("\n\tCmd     "),s("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("int")]),t._v("    "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('`json:"cmd,omitempty" form:"cmd"`')]),t._v("         "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//群聊还是私聊")]),t._v("\n\tDstid   "),s("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("int64")]),t._v("  "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('`json:"dstid,omitempty" form:"dstid"`')]),t._v("     "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//对端用户ID/群ID")]),t._v("\n\tMedia   "),s("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("int")]),t._v("    "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('`json:"media,omitempty" form:"media"`')]),t._v("     "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//消息按照什么样式展示")]),t._v("\n\tContent "),s("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("string")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('`json:"content,omitempty" form:"content"`')]),t._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//消息的内容")]),t._v("\n\tPic     "),s("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("string")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('`json:"pic,omitempty" form:"pic"`')]),t._v("         "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//预览图片")]),t._v("\n\tUrl     "),s("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("string")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('`json:"url,omitempty" form:"url"`')]),t._v("         "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//服务的URL")]),t._v("\n\tMemo    "),s("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("string")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('`json:"memo,omitempty" form:"memo"`')]),t._v("       "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//简单描述")]),t._v("\n\tAmount  "),s("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("int")]),t._v("    "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('`json:"amount,omitempty" form:"amount"`')]),t._v("   "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//其他和数字相关的")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br"),s("span",{staticClass:"line-number"},[t._v("2")]),s("br"),s("span",{staticClass:"line-number"},[t._v("3")]),s("br"),s("span",{staticClass:"line-number"},[t._v("4")]),s("br"),s("span",{staticClass:"line-number"},[t._v("5")]),s("br"),s("span",{staticClass:"line-number"},[t._v("6")]),s("br"),s("span",{staticClass:"line-number"},[t._v("7")]),s("br"),s("span",{staticClass:"line-number"},[t._v("8")]),s("br"),s("span",{staticClass:"line-number"},[t._v("9")]),s("br"),s("span",{staticClass:"line-number"},[t._v("10")]),s("br"),s("span",{staticClass:"line-number"},[t._v("11")]),s("br"),s("span",{staticClass:"line-number"},[t._v("12")]),s("br")])]),s("h2",{attrs:{id:"node结构设计"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#node结构设计"}},[t._v("#")]),t._v(" node结构设计")]),t._v(" "),s("div",{staticClass:"language-go line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-go"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("type")]),t._v(" Node "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("struct")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\tConn "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v("websocket"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Conn\n\t"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//并行转串行,")]),t._v("\n\tDataQueue "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("chan")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("byte")]),t._v("\n\tGroupSets set"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Interface\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br"),s("span",{staticClass:"line-number"},[t._v("2")]),s("br"),s("span",{staticClass:"line-number"},[t._v("3")]),s("br"),s("span",{staticClass:"line-number"},[t._v("4")]),s("br"),s("span",{staticClass:"line-number"},[t._v("5")]),s("br"),s("span",{staticClass:"line-number"},[t._v("6")]),s("br")])])])}),[],!1,null,null,null);s.default=e.exports},352:function(t,s,a){t.exports=a.p+"assets/img/image-20250503185512868.aa892b5a.png"},353:function(t,s,a){t.exports=a.p+"assets/img/image-20250503185559371.399b1843.png"},354:function(t,s,a){t.exports=a.p+"assets/img/image-20250503185718102.a38d2b82.png"},355:function(t,s,a){t.exports=a.p+"assets/img/image-20250503185814443.53e6c680.png"}}]);