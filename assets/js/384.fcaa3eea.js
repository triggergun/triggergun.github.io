(window.webpackJsonp=window.webpackJsonp||[]).push([[384],{2133:function(t,e,a){"use strict";a.r(e);var l=a(18),_=Object(l.a)({},(function(){var t=this,e=t._self._c;return e("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[e("h1",{attrs:{id:"spring框架是怎么定义事务"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#spring框架是怎么定义事务"}},[t._v("#")]),t._v(" spring框架是怎么定义事务？")]),t._v(" "),e("p",[t._v("在5.2的spring框架的"),e("code",[t._v("spring-tx")]),t._v("模块的")]),t._v(" "),e("div",{staticClass:"language-java line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-java"}},[e("code",[e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("package")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("org"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("springframework"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("transaction")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])]),t._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[t._v("1")]),e("br")])]),e("p",[t._v("包中定义了一个TransactionDefinition接口。")]),t._v(" "),e("h2",{attrs:{id:"接口信息"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#接口信息"}},[t._v("#")]),t._v(" 接口信息")]),t._v(" "),e("ul",[e("li",[e("strong",[t._v("接口名")]),t._v("："),e("code",[t._v("TransactionDefinition")])]),t._v(" "),e("li",[e("strong",[t._v("作用")]),t._v("：定义符合Spring规范的事务属性，基于类似于EJB CMT属性的传播行为定义")])]),t._v(" "),e("hr"),t._v(" "),e("h2",{attrs:{id:"事务传播行为常量-7个"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#事务传播行为常量-7个"}},[t._v("#")]),t._v(" 事务传播行为常量（7个）")]),t._v(" "),e("table",[e("thead",[e("tr",[e("th",{staticStyle:{"text-align":"left"}},[t._v("常量名")]),t._v(" "),e("th",{staticStyle:{"text-align":"left"}},[t._v("值")]),t._v(" "),e("th",{staticStyle:{"text-align":"left"}},[t._v("方法")]),t._v(" "),e("th",{staticStyle:{"text-align":"left"}},[t._v("作用描述")])])]),t._v(" "),e("tbody",[e("tr",[e("td",{staticStyle:{"text-align":"left"}},[e("code",[t._v("PROPAGATION_REQUIRED")])]),t._v(" "),e("td",{staticStyle:{"text-align":"left"}},[t._v("0")]),t._v(" "),e("td",{staticStyle:{"text-align":"left"}},[e("code",[t._v("getPropagationBehavior()")]),t._v(" 默认返回此值")]),t._v(" "),e("td",{staticStyle:{"text-align":"left"}},[e("strong",[t._v("支持当前事务，如果不存在则创建新事务")]),t._v("（默认设置）")])]),t._v(" "),e("tr",[e("td",{staticStyle:{"text-align":"left"}},[e("code",[t._v("PROPAGATION_SUPPORTS")])]),t._v(" "),e("td",{staticStyle:{"text-align":"left"}},[t._v("1")]),t._v(" "),e("td",{staticStyle:{"text-align":"left"}},[t._v("-")]),t._v(" "),e("td",{staticStyle:{"text-align":"left"}},[e("strong",[t._v("支持当前事务，如果不存在则以非事务方式执行")])])]),t._v(" "),e("tr",[e("td",{staticStyle:{"text-align":"left"}},[e("code",[t._v("PROPAGATION_MANDATORY")])]),t._v(" "),e("td",{staticStyle:{"text-align":"left"}},[t._v("2")]),t._v(" "),e("td",{staticStyle:{"text-align":"left"}},[t._v("-")]),t._v(" "),e("td",{staticStyle:{"text-align":"left"}},[e("strong",[t._v("必须在事务中运行，否则抛出异常")])])]),t._v(" "),e("tr",[e("td",{staticStyle:{"text-align":"left"}},[e("code",[t._v("PROPAGATION_REQUIRES_NEW")])]),t._v(" "),e("td",{staticStyle:{"text-align":"left"}},[t._v("3")]),t._v(" "),e("td",{staticStyle:{"text-align":"left"}},[t._v("-")]),t._v(" "),e("td",{staticStyle:{"text-align":"left"}},[e("strong",[t._v("总是创建新事务，如果存在当前事务则挂起")])])]),t._v(" "),e("tr",[e("td",{staticStyle:{"text-align":"left"}},[e("code",[t._v("PROPAGATION_NOT_SUPPORTED")])]),t._v(" "),e("td",{staticStyle:{"text-align":"left"}},[t._v("4")]),t._v(" "),e("td",{staticStyle:{"text-align":"left"}},[t._v("-")]),t._v(" "),e("td",{staticStyle:{"text-align":"left"}},[e("strong",[t._v("以非事务方式执行，如果存在当前事务则挂起")])])]),t._v(" "),e("tr",[e("td",{staticStyle:{"text-align":"left"}},[e("code",[t._v("PROPAGATION_NEVER")])]),t._v(" "),e("td",{staticStyle:{"text-align":"left"}},[t._v("5")]),t._v(" "),e("td",{staticStyle:{"text-align":"left"}},[t._v("-")]),t._v(" "),e("td",{staticStyle:{"text-align":"left"}},[e("strong",[t._v("不能在事务中运行，否则抛出异常")])])]),t._v(" "),e("tr",[e("td",{staticStyle:{"text-align":"left"}},[e("code",[t._v("PROPAGATION_NESTED")])]),t._v(" "),e("td",{staticStyle:{"text-align":"left"}},[t._v("6")]),t._v(" "),e("td",{staticStyle:{"text-align":"left"}},[t._v("-")]),t._v(" "),e("td",{staticStyle:{"text-align":"left"}},[e("strong",[t._v("如果存在当前事务则在嵌套事务中执行，否则同REQUIRED")])])])])]),t._v(" "),e("hr"),t._v(" "),e("h2",{attrs:{id:"事务隔离级别常量-5个"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#事务隔离级别常量-5个"}},[t._v("#")]),t._v(" 事务隔离级别常量（5个）")]),t._v(" "),e("table",[e("thead",[e("tr",[e("th",{staticStyle:{"text-align":"left"}},[t._v("常量名")]),t._v(" "),e("th",{staticStyle:{"text-align":"left"}},[t._v("值")]),t._v(" "),e("th",{staticStyle:{"text-align":"left"}},[t._v("方法")]),t._v(" "),e("th",{staticStyle:{"text-align":"left"}},[t._v("作用描述")])])]),t._v(" "),e("tbody",[e("tr",[e("td",{staticStyle:{"text-align":"left"}},[e("code",[t._v("ISOLATION_DEFAULT")])]),t._v(" "),e("td",{staticStyle:{"text-align":"left"}},[t._v("-1")]),t._v(" "),e("td",{staticStyle:{"text-align":"left"}},[e("code",[t._v("getIsolationLevel()")]),t._v(" 默认返回此值")]),t._v(" "),e("td",{staticStyle:{"text-align":"left"}},[e("strong",[t._v("使用底层数据存储的默认隔离级别")])])]),t._v(" "),e("tr",[e("td",{staticStyle:{"text-align":"left"}},[e("code",[t._v("ISOLATION_READ_UNCOMMITTED")])]),t._v(" "),e("td",{staticStyle:{"text-align":"left"}},[t._v("1")]),t._v(" "),e("td",{staticStyle:{"text-align":"left"}},[t._v("-")]),t._v(" "),e("td",{staticStyle:{"text-align":"left"}},[e("strong",[t._v("读未提交")]),t._v("（允许脏读、不可重复读、幻读）")])]),t._v(" "),e("tr",[e("td",{staticStyle:{"text-align":"left"}},[e("code",[t._v("ISOLATION_READ_COMMITTED")])]),t._v(" "),e("td",{staticStyle:{"text-align":"left"}},[t._v("2")]),t._v(" "),e("td",{staticStyle:{"text-align":"left"}},[t._v("-")]),t._v(" "),e("td",{staticStyle:{"text-align":"left"}},[e("strong",[t._v("读已提交")]),t._v("（防止脏读）")])]),t._v(" "),e("tr",[e("td",{staticStyle:{"text-align":"left"}},[e("code",[t._v("ISOLATION_REPEATABLE_READ")])]),t._v(" "),e("td",{staticStyle:{"text-align":"left"}},[t._v("4")]),t._v(" "),e("td",{staticStyle:{"text-align":"left"}},[t._v("-")]),t._v(" "),e("td",{staticStyle:{"text-align":"left"}},[e("strong",[t._v("可重复读")]),t._v("（防止脏读、不可重复读）")])]),t._v(" "),e("tr",[e("td",{staticStyle:{"text-align":"left"}},[e("code",[t._v("ISOLATION_SERIALIZABLE")])]),t._v(" "),e("td",{staticStyle:{"text-align":"left"}},[t._v("8")]),t._v(" "),e("td",{staticStyle:{"text-align":"left"}},[t._v("-")]),t._v(" "),e("td",{staticStyle:{"text-align":"left"}},[e("strong",[t._v("串行化")]),t._v("（防止所有并发问题）")])])])]),t._v(" "),e("hr"),t._v(" "),e("h2",{attrs:{id:"超时时间常量-1个"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#超时时间常量-1个"}},[t._v("#")]),t._v(" 超时时间常量（1个）")]),t._v(" "),e("table",[e("thead",[e("tr",[e("th",{staticStyle:{"text-align":"left"}},[t._v("常量名")]),t._v(" "),e("th",{staticStyle:{"text-align":"left"}},[t._v("值")]),t._v(" "),e("th",{staticStyle:{"text-align":"left"}},[t._v("方法")]),t._v(" "),e("th",{staticStyle:{"text-align":"left"}},[t._v("作用描述")])])]),t._v(" "),e("tbody",[e("tr",[e("td",{staticStyle:{"text-align":"left"}},[e("code",[t._v("TIMEOUT_DEFAULT")])]),t._v(" "),e("td",{staticStyle:{"text-align":"left"}},[t._v("-1")]),t._v(" "),e("td",{staticStyle:{"text-align":"left"}},[e("code",[t._v("getTimeout()")]),t._v(" 默认返回此值")]),t._v(" "),e("td",{staticStyle:{"text-align":"left"}},[e("strong",[t._v("使用底层事务系统默认超时，或不支持超时")])])])])]),t._v(" "),e("hr"),t._v(" "),e("h2",{attrs:{id:"接口方法-6个"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#接口方法-6个"}},[t._v("#")]),t._v(" 接口方法（6个）")]),t._v(" "),e("h3",{attrs:{id:"_1-传播行为相关"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_1-传播行为相关"}},[t._v("#")]),t._v(" 1. 传播行为相关")]),t._v(" "),e("table",[e("thead",[e("tr",[e("th",{staticStyle:{"text-align":"left"}},[t._v("方法签名")]),t._v(" "),e("th",{staticStyle:{"text-align":"left"}},[t._v("默认实现")]),t._v(" "),e("th",{staticStyle:{"text-align":"left"}},[t._v("返回值")]),t._v(" "),e("th",{staticStyle:{"text-align":"left"}},[t._v("说明")])])]),t._v(" "),e("tbody",[e("tr",[e("td",{staticStyle:{"text-align":"left"}},[e("code",[t._v("int getPropagationBehavior()")])]),t._v(" "),e("td",{staticStyle:{"text-align":"left"}},[t._v("返回 "),e("code",[t._v("PROPAGATION_REQUIRED")]),t._v(" (0)")]),t._v(" "),e("td",{staticStyle:{"text-align":"left"}},[t._v("传播行为常量值")]),t._v(" "),e("td",{staticStyle:{"text-align":"left"}},[t._v("获取事务传播行为")])])])]),t._v(" "),e("h3",{attrs:{id:"_2-隔离级别相关"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_2-隔离级别相关"}},[t._v("#")]),t._v(" 2. 隔离级别相关")]),t._v(" "),e("table",[e("thead",[e("tr",[e("th",{staticStyle:{"text-align":"left"}},[t._v("方法签名")]),t._v(" "),e("th",{staticStyle:{"text-align":"left"}},[t._v("默认实现")]),t._v(" "),e("th",{staticStyle:{"text-align":"left"}},[t._v("返回值")]),t._v(" "),e("th",{staticStyle:{"text-align":"left"}},[t._v("说明")])])]),t._v(" "),e("tbody",[e("tr",[e("td",{staticStyle:{"text-align":"left"}},[e("code",[t._v("int getIsolationLevel()")])]),t._v(" "),e("td",{staticStyle:{"text-align":"left"}},[t._v("返回 "),e("code",[t._v("ISOLATION_DEFAULT")]),t._v(" (-1)")]),t._v(" "),e("td",{staticStyle:{"text-align":"left"}},[t._v("隔离级别常量值")]),t._v(" "),e("td",{staticStyle:{"text-align":"left"}},[t._v("获取事务隔离级别")])])])]),t._v(" "),e("h3",{attrs:{id:"_3-超时时间相关"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_3-超时时间相关"}},[t._v("#")]),t._v(" 3. 超时时间相关")]),t._v(" "),e("table",[e("thead",[e("tr",[e("th",{staticStyle:{"text-align":"left"}},[t._v("方法签名")]),t._v(" "),e("th",{staticStyle:{"text-align":"left"}},[t._v("默认实现")]),t._v(" "),e("th",{staticStyle:{"text-align":"left"}},[t._v("返回值")]),t._v(" "),e("th",{staticStyle:{"text-align":"left"}},[t._v("说明")])])]),t._v(" "),e("tbody",[e("tr",[e("td",{staticStyle:{"text-align":"left"}},[e("code",[t._v("int getTimeout()")])]),t._v(" "),e("td",{staticStyle:{"text-align":"left"}},[t._v("返回 "),e("code",[t._v("TIMEOUT_DEFAULT")]),t._v(" (-1)")]),t._v(" "),e("td",{staticStyle:{"text-align":"left"}},[t._v("秒数")]),t._v(" "),e("td",{staticStyle:{"text-align":"left"}},[t._v("获取事务超时时间")])])])]),t._v(" "),e("h3",{attrs:{id:"_4-只读标志相关"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_4-只读标志相关"}},[t._v("#")]),t._v(" 4. 只读标志相关")]),t._v(" "),e("table",[e("thead",[e("tr",[e("th",{staticStyle:{"text-align":"left"}},[t._v("方法签名")]),t._v(" "),e("th",{staticStyle:{"text-align":"left"}},[t._v("默认实现")]),t._v(" "),e("th",{staticStyle:{"text-align":"left"}},[t._v("返回值")]),t._v(" "),e("th",{staticStyle:{"text-align":"left"}},[t._v("说明")])])]),t._v(" "),e("tbody",[e("tr",[e("td",{staticStyle:{"text-align":"left"}},[e("code",[t._v("boolean isReadOnly()")])]),t._v(" "),e("td",{staticStyle:{"text-align":"left"}},[t._v("返回 "),e("code",[t._v("false")])]),t._v(" "),e("td",{staticStyle:{"text-align":"left"}},[t._v("boolean")]),t._v(" "),e("td",{staticStyle:{"text-align":"left"}},[t._v("事务是否为只读")])])])]),t._v(" "),e("h3",{attrs:{id:"_5-事务名称相关"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_5-事务名称相关"}},[t._v("#")]),t._v(" 5. 事务名称相关")]),t._v(" "),e("table",[e("thead",[e("tr",[e("th",{staticStyle:{"text-align":"left"}},[t._v("方法签名")]),t._v(" "),e("th",{staticStyle:{"text-align":"left"}},[t._v("默认实现")]),t._v(" "),e("th",{staticStyle:{"text-align":"left"}},[t._v("返回值")]),t._v(" "),e("th",{staticStyle:{"text-align":"left"}},[t._v("说明")])])]),t._v(" "),e("tbody",[e("tr",[e("td",{staticStyle:{"text-align":"left"}},[e("code",[t._v("String getName()")])]),t._v(" "),e("td",{staticStyle:{"text-align":"left"}},[t._v("返回 "),e("code",[t._v("null")])]),t._v(" "),e("td",{staticStyle:{"text-align":"left"}},[t._v("字符串")]),t._v(" "),e("td",{staticStyle:{"text-align":"left"}},[t._v("获取事务名称（用于监控）")])])])]),t._v(" "),e("h3",{attrs:{id:"_6-静态构建方法"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_6-静态构建方法"}},[t._v("#")]),t._v(" 6. 静态构建方法")]),t._v(" "),e("table",[e("thead",[e("tr",[e("th",{staticStyle:{"text-align":"left"}},[t._v("方法签名")]),t._v(" "),e("th",{staticStyle:{"text-align":"left"}},[t._v("返回值")]),t._v(" "),e("th",{staticStyle:{"text-align":"left"}},[t._v("说明")])])]),t._v(" "),e("tbody",[e("tr",[e("td",{staticStyle:{"text-align":"left"}},[e("code",[t._v("static TransactionDefinition withDefaults()")])]),t._v(" "),e("td",{staticStyle:{"text-align":"left"}},[e("code",[t._v("TransactionDefinition")])]),t._v(" "),e("td",{staticStyle:{"text-align":"left"}},[t._v("返回具有默认值的不可修改的事务定义")])])])]),t._v(" "),e("h2",{attrs:{id:"关键行为规则总结"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#关键行为规则总结"}},[t._v("#")]),t._v(" 关键行为规则总结")]),t._v(" "),e("h3",{attrs:{id:"常量与方法的对应关系"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#常量与方法的对应关系"}},[t._v("#")]),t._v(" 常量与方法的对应关系")]),t._v(" "),e("div",{staticClass:"language-java line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-java"}},[e("code",[e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 常量定义（用于配置）")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token constant"}},[t._v("PROPAGATION_REQUIRED")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v("\n\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 方法获取（运行时使用）")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("getPropagationBehavior")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("->")]),t._v(" 默认返回"),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v("\n")])]),t._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[t._v("1")]),e("br"),e("span",{staticClass:"line-number"},[t._v("2")]),e("br"),e("span",{staticClass:"line-number"},[t._v("3")]),e("br"),e("span",{staticClass:"line-number"},[t._v("4")]),e("br"),e("span",{staticClass:"line-number"},[t._v("5")]),e("br")])]),e("h3",{attrs:{id:"重要约束条件"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#重要约束条件"}},[t._v("#")]),t._v(" 重要约束条件")]),t._v(" "),e("ol",[e("li",[e("p",[e("strong",[t._v("隔离级别和超时只在真正启动新事务时生效")])]),t._v(" "),e("ul",[e("li",[t._v("仅适用于："),e("code",[t._v("PROPAGATION_REQUIRED")]),t._v("、"),e("code",[t._v("PROPAGATION_REQUIRES_NEW")]),t._v("、"),e("code",[t._v("PROPAGATION_NESTED")])]),t._v(" "),e("li",[t._v("在其他传播行为中设置这些属性通常无意义")])])]),t._v(" "),e("li",[e("p",[e("strong",[t._v("只读标志适用范围更广")])]),t._v(" "),e("div",{staticClass:"language-java line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-java"}},[e("code",[e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 适用于：")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 1. 实际资源事务（PROPAGATION_REQUIRED/REQUIRES_NEW）")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 2. 资源级别非事务运行（PROPAGATION_SUPPORTS）")]),t._v("\n")])]),t._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[t._v("1")]),e("br"),e("span",{staticClass:"line-number"},[t._v("2")]),e("br"),e("span",{staticClass:"line-number"},[t._v("3")]),e("br")])])]),t._v(" "),e("li",[e("p",[e("strong",[t._v("特殊传播行为的注意事项")])]),t._v(" "),e("ul",[e("li",[e("code",[t._v("PROPAGATION_NESTED")]),t._v("：需要特定事务管理器支持")]),t._v(" "),e("li",[t._v("事务挂起：不是所有事务管理器都支持")])])])]),t._v(" "),e("h3",{attrs:{id:"设计模式体现"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#设计模式体现"}},[t._v("#")]),t._v(" 设计模式体现")]),t._v(" "),e("p",[t._v("这是一个典型的"),e("strong",[t._v("接口定义模式")]),t._v("：")]),t._v(" "),e("ul",[e("li",[e("strong",[t._v("常量定义")]),t._v("：提供标准化的配置选项")]),t._v(" "),e("li",[e("strong",[t._v("getter方法")]),t._v("：提供运行时访问接口")]),t._v(" "),e("li",[e("strong",[t._v("默认实现")]),t._v("：提供合理的默认行为")]),t._v(" "),e("li",[e("strong",[t._v("静态工厂方法")]),t._v("："),e("code",[t._v("withDefaults()")]),t._v(" 提供便捷的创建方式")])]),t._v(" "),e("p",[t._v("这个接口的设计很好地体现了"),e("strong",[t._v("约定优于配置")]),t._v("的原则，为Spring事务管理提供了灵活而统一的基础。")])])}),[],!1,null,null,null);e.default=_.exports}}]);