(window.webpackJsonp=window.webpackJsonp||[]).push([[29],{1986:function(t,e,a){"use strict";a.r(e);var s=a(18),n=Object(s.a)({},(function(){var t=this,e=t._self._c;return e("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[e("h1",{attrs:{id:"python项目流水线脚本"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#python项目流水线脚本"}},[t._v("#")]),t._v(" python项目流水线脚本")]),t._v(" "),e("h2",{attrs:{id:"第一步-拉取源代码"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#第一步-拉取源代码"}},[t._v("#")]),t._v(" 第一步)拉取源代码")]),t._v(" "),e("p",[e("img",{attrs:{src:a(566),alt:"image-20250401132713292"}})]),t._v(" "),e("p",[e("img",{attrs:{src:a(567),alt:"image-20250401132746068"}})]),t._v(" "),e("p",[e("img",{attrs:{src:a(568),alt:"image-20250401135538687"}})]),t._v(" "),e("h2",{attrs:{id:"第二步-构建镜像"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#第二步-构建镜像"}},[t._v("#")]),t._v(" 第二步)构建镜像")]),t._v(" "),e("p",[t._v("在构建镜像前有前提就是要配置远程连接的服务器。")]),t._v(" "),e("p",[e("img",{attrs:{src:a(569),alt:"image-20250401140648759"}})]),t._v(" "),e("p",[e("strong",[t._v("Source files属性填写：")])]),t._v(" "),e("table",[e("thead",[e("tr",[e("th",{staticStyle:{"text-align":"left"}},[t._v("属性值")]),t._v(" "),e("th",[t._v("描述")])])]),t._v(" "),e("tbody",[e("tr",[e("td",{staticStyle:{"text-align":"left"}},[e("code",[t._v("**/*")])]),t._v(" "),e("td",[t._v("表示匹配任意层级目录下的文件")])]),t._v(" "),e("tr",[e("td",{staticStyle:{"text-align":"left"}}),t._v(" "),e("td")]),t._v(" "),e("tr",[e("td",{staticStyle:{"text-align":"left"}}),t._v(" "),e("td")])])]),t._v(" "),e("p",[e("code",[t._v("**/*")]),t._v("的效果如下：")]),t._v(" "),e("p",[e("img",{attrs:{src:a(570),alt:"image-20250401144816700"}})]),t._v(" "),e("p",[t._v("项目的目录结构：")]),t._v(" "),e("p",[e("img",{attrs:{src:a(571),alt:"image-20250401145438528"}})]),t._v(" "),e("p",[e("strong",[t._v("Remote directory的属性填写：")])]),t._v(" "),e("table",[e("thead",[e("tr",[e("th",[t._v("属性值")]),t._v(" "),e("th",[t._v("描述")])])]),t._v(" "),e("tbody",[e("tr",[e("td",[e("code",[t._v("/usr/local/flask_file_upload")])]),t._v(" "),e("td",[t._v("有问题的写法。效果如下图：")])]),t._v(" "),e("tr",[e("td"),t._v(" "),e("td")]),t._v(" "),e("tr",[e("td"),t._v(" "),e("td")])])]),t._v(" "),e("p",[e("code",[t._v("/usr/local/flask_file_upload")]),t._v("的写法效果图如下：")]),t._v(" "),e("p",[e("img",{attrs:{src:a(572),alt:"image-20250401150013496"}})]),t._v(" "),e("p",[e("img",{attrs:{src:a(573),alt:"image-20250401145929778"}})]),t._v(" "),e("p",[e("img",{attrs:{src:a(574),alt:"image-20250401150208095"}})]),t._v(" "),e("p",[e("code",[t._v("flask_file_upload")]),t._v("的写法效果图如下：")]),t._v(" "),e("p",[e("img",{attrs:{src:a(575),alt:"image-20250401150536961"}})]),t._v(" "),e("p",[t._v("::: tip总结")]),t._v(" "),e("p",[t._v("传输文件到目标主机服务器的路径是：/usr/local  +  自己定义的路径。")]),t._v(" "),e("p",[t._v(":::")]),t._v(" "),e("p",[t._v("构建的命令：")]),t._v(" "),e("div",{staticClass:"language-shell line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[e("span",{pre:!0,attrs:{class:"token function"}},[t._v("docker")]),t._v(" build  "),e("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("--network")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("host")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-t")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("192.168")]),t._v(".5.203:80/public/flask_file_upload:"),e("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$tag")]),t._v(" /usr/local/flask_file_upload\n"),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("docker")]),t._v(" login "),e("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-u")]),t._v(" admin "),e("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-p")]),t._v(" Harbor12345 "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("192.168")]),t._v(".5.203:80\n"),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("docker")]),t._v(" push "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("192.168")]),t._v(".5.203:80/public/flask_file_upload:"),e("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$tag")]),t._v("\n")])]),t._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[t._v("1")]),e("br"),e("span",{staticClass:"line-number"},[t._v("2")]),e("br"),e("span",{staticClass:"line-number"},[t._v("3")]),e("br")])]),e("p",[e("img",{attrs:{src:a(576),alt:"image-20250401162242522"}})]),t._v(" "),e("h2",{attrs:{id:"第三步-目标服务器拉取镜像"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#第三步-目标服务器拉取镜像"}},[t._v("#")]),t._v(" 第三步)目标服务器拉取镜像")]),t._v(" "),e("h2",{attrs:{id:"问题"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#问题"}},[t._v("#")]),t._v(" 问题")]),t._v(" "),e("p",[t._v("问题一：")]),t._v(" "),e("p",[e("img",{attrs:{src:a(577),alt:"image-20250401135042070"}})]),t._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[t._v("无法连接仓库：Command \"git ls-remote -h -- http://192.168.5.240/python_project_group/flask_file_upload HEAD\" returned status code 128:\nstdout:\nstderr: remote: HTTP Basic: Access denied. If a password was provided for Git authentication, the password was incorrect or you're required to use a token instead of a password. If a token was provided, it was either incorrect, expired, or improperly scoped. See http://192.168.5.240/help/topics/git/troubleshooting_git.md#error-on-git-fetch-http-basic-access-denied\nfatal: Authentication failed for 'http://192.168.5.240/python_project_group/flask_file_upload.git/'\n")])]),t._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[t._v("1")]),e("br"),e("span",{staticClass:"line-number"},[t._v("2")]),e("br"),e("span",{staticClass:"line-number"},[t._v("3")]),e("br"),e("span",{staticClass:"line-number"},[t._v("4")]),e("br")])]),e("p",[t._v("无法连接仓库连接仓库为什么呢？")]),t._v(" "),e("p",[t._v("解决：")]),t._v(" "),e("p",[e("img",{attrs:{src:a(578),alt:"image-20250401135201431"}})]),t._v(" "),e("p",[e("img",{attrs:{src:a(579),alt:"image-20250401135220006"}})]),t._v(" "),e("p",[e("strong",[e("img",{attrs:{src:a(580),alt:"image-20250401135320454"}})])]),t._v(" "),e("p",[t._v("问题2：")]),t._v(" "),e("p",[t._v("在执行构建python的镜像的时候:")]),t._v(" "),e("div",{staticClass:"language-shell line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[e("span",{pre:!0,attrs:{class:"token function"}},[t._v("docker")]),t._v(" build "),e("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-t")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("192.168")]),t._v(".5.203:80/public/flask_file_upload:1.0.0 /usr/local/flask_file_upload\n")])]),t._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[t._v("1")]),e("br")])]),e("p",[t._v("为什么无法连接下载呢？我个人在windows的docker都能正常的构建。")]),t._v(" "),e("p",[t._v("问题的分析：")]),t._v(" "),e("ol",[e("li",[t._v("可能是没有换源。我当前部署在linux的系统上。")]),t._v(" "),e("li",[t._v("我windows的依赖下载可能都是通过走魔法进行下载的。")])]),t._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[t._v(" > [9/9] RUN pip install -r requirements.txt:                                                                                                                                                                                                                                                                                                      \n0.613 Looking in indexes: http://mirrors.aliyun.com/pypi/simple                                                                                                                                                                                                                                                                                    \n5.625 WARNING: Retrying (Retry(total=4, connect=None, read=None, redirect=None, status=None)) after connection broken by 'NewConnectionError('<pip._vendor.urllib3.connection.HTTPConnection object at 0x7f231582f7d0>: Failed to establish a new connection: [Errno -3] Try again')': /pypi/simple/flask/                                         \n11.13 WARNING: Retrying (Retry(total=3, connect=None, read=None, redirect=None, status=None)) after connection broken by 'NewConnectionError('<pip._vendor.urllib3.connection.HTTPConnection object at 0x7f23157f4290>: Failed to establish a new connection: [Errno -3] Try again')': /pypi/simple/flask/                                         \n17.14 WARNING: Retrying (Retry(total=2, connect=None, read=None, redirect=None, status=None)) after connection broken by 'NewConnectionError('<pip._vendor.urllib3.connection.HTTPConnection object at 0x7f23157f4750>: Failed to establish a new connection: [Errno -3] Try again')': /pypi/simple/flask/                                         \n24.15 WARNING: Retrying (Retry(total=1, connect=None, read=None, redirect=None, status=None)) after connection broken by 'NewConnectionError('<pip._vendor.urllib3.connection.HTTPConnection object at 0x7f23157f4c10>: Failed to establish a new connection: [Errno -3] Try again')': /pypi/simple/flask/\n33.16 WARNING: Retrying (Retry(total=0, connect=None, read=None, redirect=None, status=None)) after connection broken by 'NewConnectionError('<pip._vendor.urllib3.connection.HTTPConnection object at 0x7f231584ead0>: Failed to establish a new connection: [Errno -3] Try again')': /pypi/simple/flask/\n")])]),t._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[t._v("1")]),e("br"),e("span",{staticClass:"line-number"},[t._v("2")]),e("br"),e("span",{staticClass:"line-number"},[t._v("3")]),e("br"),e("span",{staticClass:"line-number"},[t._v("4")]),e("br"),e("span",{staticClass:"line-number"},[t._v("5")]),e("br"),e("span",{staticClass:"line-number"},[t._v("6")]),e("br"),e("span",{staticClass:"line-number"},[t._v("7")]),e("br")])]),e("p",[t._v("主要原因是：容器的内部环境网络无法连接使用。(大概是这个意思)")]),t._v(" "),e("p",[t._v("问题的解决：")]),t._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[t._v(" docker build --network host -t 192.168.5.203:80/public/flask_file_upload:1.0.0 /usr/local/flask_file_upload\n")])]),t._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[t._v("1")]),e("br")])]),e("p",[e("code",[t._v("--network host")]),t._v("是表示"),e("strong",[t._v("使用宿主网络构建")]),t._v("。")]),t._v(" "),e("p",[e("img",{attrs:{src:a(581),alt:"image-20250401161747001"}})]),t._v(" "),e("p",[t._v("在centos上构建构成全部通过。")]),t._v(" "),e("p",[t._v("问题三：")]),t._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[t._v('[root@VM-8-4-centos ~]# docker pull www.tc03vd.top:9001/public/flask_file_upload:1.0.16\nError response from daemon: Get "https://www.tc03vd.top:9001/v2/": http: server gave HTTP response to HTTPS client\n[root@VM-8-4-centos ~]# docker pull 43.136.124.89:9001/public/flask_file_upload:1.0.16\nError response from daemon: Get "https://43.136.124.89:9001/v2/": http: server gave HTTP response to HTTPS clien\n')])]),t._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[t._v("1")]),e("br"),e("span",{staticClass:"line-number"},[t._v("2")]),e("br"),e("span",{staticClass:"line-number"},[t._v("3")]),e("br"),e("span",{staticClass:"line-number"},[t._v("4")]),e("br")])])])}),[],!1,null,null,null);e.default=n.exports},566:function(t,e,a){t.exports=a.p+"assets/img/image-20250401132713292.105b2884.png"},567:function(t,e,a){t.exports=a.p+"assets/img/image-20250401132746068.550ec322.png"},568:function(t,e,a){t.exports=a.p+"assets/img/image-20250401135538687.ab9e6089.png"},569:function(t,e,a){t.exports=a.p+"assets/img/image-20250401140648759.ea5c3a92.png"},570:function(t,e,a){t.exports=a.p+"assets/img/image-20250401144816700.3f65af5b.png"},571:function(t,e,a){t.exports=a.p+"assets/img/image-20250401145438528.87653f58.png"},572:function(t,e,a){t.exports=a.p+"assets/img/image-20250401150013496.7c475364.png"},573:function(t,e,a){t.exports=a.p+"assets/img/image-20250401145929778.7303ce74.png"},574:function(t,e,a){t.exports=a.p+"assets/img/image-20250401150208095.e6737640.png"},575:function(t,e,a){t.exports=a.p+"assets/img/image-20250401150536961.568d8225.png"},576:function(t,e,a){t.exports=a.p+"assets/img/image-20250401162242522.b551538c.png"},577:function(t,e,a){t.exports=a.p+"assets/img/image-20250401135042070.98e32f24.png"},578:function(t,e,a){t.exports=a.p+"assets/img/image-20250401135201431.0974aae6.png"},579:function(t,e,a){t.exports=a.p+"assets/img/image-20250401135220006.6a971da1.png"},580:function(t,e,a){t.exports=a.p+"assets/img/image-20250401135320454.e2f6a4f8.png"},581:function(t,e,a){t.exports=a.p+"assets/img/image-20250401161747001.1f43ac0c.png"}}]);